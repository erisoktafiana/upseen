
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECrew Absensi Karyawan Transwisata</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-marquee { animation: marquee 30s linear infinite; }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md slide-in">
            <div class="text-center mb-8">
                <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" id="loginLogo">
                    <img src="" alt="Logo" class="w-10 h-10 object-contain hidden" id="loginLogoImg">
                    <i class="fas fa-users text-white text-2xl" id="loginLogoIcon"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2" id="loginTitle">ECrew Absensi</h1>
                <p class="text-gray-600" id="loginSubtitle">Transwisata Employee System</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="nama@transwisata.com" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="••••••••" required>
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-600">Ingat saya</span>
                    </label>
                    <a href="#" class="text-sm text-blue-600 hover:text-blue-800">Lupa password?</a>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    Masuk
                </button>
            </form>
            

        </div>
    </div>

    <!-- User Dashboard -->
    <div id="userDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="bg-blue-600 w-8 h-8 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-users text-white text-sm"></i>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-800">ECrew Absensi</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Selamat datang, <span id="userName" class="font-medium">John Doe</span></span>
                        <div class="relative">
                            <button onclick="toggleProfileMenu()" class="flex items-center space-x-2 focus:outline-none">
                                <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-gray-300 hover:border-blue-500 transition duration-200">
                                    <img id="userProfilePhoto" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236B7280'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Profile" class="w-full h-full object-cover">
                                </div>
                                <i class="fas fa-chevron-down text-xs text-gray-500"></i>
                            </button>
                            
                            <!-- Profile Dropdown -->
                            <div id="profileMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <div class="py-2">
                                    <button onclick="showProfileModal()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">
                                        <i class="fas fa-user mr-2"></i>Edit Profile
                                    </button>
                                    <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- News Ticker -->
        <div class="bg-blue-600 text-white py-2 overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center">
                    <span class="bg-white text-blue-600 px-3 py-1 rounded-full text-sm font-medium mr-4 flex-shrink-0">
                        <i class="fas fa-bullhorn mr-1"></i>BERITA
                    </span>
                    <div class="overflow-hidden flex-1">
                        <div id="newsTickerContent" class="whitespace-nowrap animate-marquee">
                            <!-- News ticker will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Latest News Section -->
            <div class="bg-white rounded-2xl card-shadow p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-newspaper text-blue-600 mr-2"></i>
                        Berita Terkini
                    </h2>
                    <button onclick="showTab('news')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        Lihat Semua <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
                <div id="newsPreviewContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- News will be populated by JavaScript -->
                </div>
            </div>

            <!-- Clock In/Out Section -->
            <div class="bg-white rounded-2xl card-shadow p-8 mb-8">
                <div class="text-center mb-6">
                    <div class="mb-6">
                        <div id="currentTime" class="text-4xl font-bold text-gray-800 mb-2"></div>
                        <div id="currentDate" class="text-lg text-gray-600"></div>
                    </div>
                    
                    <div class="flex justify-center space-x-6">
                        <button id="clockInBtn" onclick="showClockInForm()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl font-medium transition duration-200 pulse-animation">
                            <i class="fas fa-clock mr-2"></i>Clock In
                        </button>
                        <button id="clockOutBtn" onclick="showClockOutForm()" class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-xl font-medium transition duration-200 disabled:opacity-50" disabled>
                            <i class="fas fa-clock mr-2"></i>Clock Out
                        </button>
                    </div>
                </div>

                <!-- Clock In Form -->
                <div id="clockInForm" class="hidden mt-8 border-t pt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6 text-center">Form Absen Masuk</h3>
                    <form id="attendanceInForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Personal Info -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap *</label>
                                <input type="text" id="employeeName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                <input type="email" id="employeeEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Divisi *</label>
                                <input type="text" id="employeeDivision" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Posisi *</label>
                                <input type="text" id="employeePosition" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bertugas Sebagai *</label>
                                <select id="dutyAs" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">Pilih Tugas</option>
                                    <option value="Director">Director</option>
                                    <option value="Safety, Quality & Security Manager">Safety, Quality & Security Manager</option>
                                    <option value="Operation Manager">Operation Manager</option>
                                    <option value="Maintenance Manager">Maintenance Manager</option>
                                    <option value="Chief Pilot Fixed Wing">Chief Pilot Fixed Wing</option>
                                    <option value="Chief Pilot Rotary Wing">Chief Pilot Rotary Wing</option>
                                    <option value="Chief Flight Support">Chief Flight Support</option>
                                    <option value="Chief Inspector">Chief Inspector</option>
                                    <option value="Chief Engineer">Chief Engineer</option>
                                    <option value="Chief Finance, Accounting & Staf">Chief Finance, Accounting & Staf</option>
                                    <option value="Chief Engineering">Chief Engineering</option>
                                    <option value="Pilot in Command">Pilot in Command</option>
                                    <option value="Second in Command">Second in Command</option>
                                    <option value="Ground Instructor">Ground Instructor</option>
                                    <option value="Flight Instructor">Flight Instructor</option>
                                    <option value="Company Check Pilot">Company Check Pilot</option>
                                    <option value="Engineer">Engineer</option>
                                    <option value="Line Pilot">Line Pilot</option>
                                    <option value="Cabin Service">Cabin Service</option>
                                    <option value="Student">Student</option>
                                    <option value="Flight Support">Flight Support</option>
                                    <option value="Ground Support">Ground Support</option>
                                    <option value="Technical Representative">Technical Representative</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Logistic">Logistic</option>
                                    <option value="Aviation Security">Aviation Security</option>
                                    <option value="Driver">Driver</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Pekerjaan *</label>
                                <select id="workType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">Pilih Jenis Pekerjaan</option>
                                    <option value="Office Hour">Office Hour</option>
                                    <option value="Standby Flight">Standby Flight</option>
                                    <option value="Standby on Call">Standby on Call</option>
                                    <option value="Pos One Gate">Pos One Gate</option>
                                    <option value="Day Off">Day Off</option>
                                    <option value="Day Off 7 Consecutive Days for Pilot">Day Off 7 Consecutive Days for Pilot</option>
                                    <option value="Flight Duty VIP">Flight Duty VIP</option>
                                    <option value="Ferry Flight">Ferry Flight</option>
                                    <option value="PPC Simulator">PPC Simulator</option>
                                    <option value="PPC Aircraft">PPC Aircraft</option>
                                    <option value="Test Flight">Test Flight</option>
                                    <option value="Ground Run">Ground Run</option>
                                    <option value="Recurrent Training">Recurrent Training</option>
                                    <option value="Recency Flight">Recency Flight</option>
                                    <option value="Meeting Out of Office">Meeting Out of Office</option>
                                    <option value="Medical Examination">Medical Examination</option>
                                    <option value="Annual Leave">Annual Leave</option>
                                    <option value="Sick">Sick</option>
                                    <option value="Technical Representative">Technical Representative</option>
                                    <option value="Aviation Security">Aviation Security</option>
                                    <option value="Over Time">Over Time</option>
                                </select>
                            </div>
                        </div>

                        <!-- Photo Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Foto Masuk *</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <video id="cameraPreview" class="hidden w-full max-w-sm mx-auto rounded-lg mb-4"></video>
                                <canvas id="photoCanvas" class="hidden"></canvas>
                                <img id="capturedPhoto" class="hidden w-full max-w-sm mx-auto rounded-lg mb-4">
                                <div id="cameraControls">
                                    <button type="button" onclick="startCamera()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mr-2">
                                        <i class="fas fa-camera mr-2"></i>Buka Kamera
                                    </button>
                                    <button type="button" id="captureBtn" onclick="capturePhoto()" class="hidden bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 mr-2">
                                        <i class="fas fa-camera mr-2"></i>Ambil Foto
                                    </button>
                                    <button type="button" id="retakeBtn" onclick="retakePhoto()" class="hidden bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                                        <i class="fas fa-redo mr-2"></i>Foto Ulang
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Location Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Masuk *</label>
                            <div class="space-y-4">
                                <button type="button" onclick="getCurrentLocation('in')" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Dapatkan Lokasi Saat Ini
                                </button>
                                <div id="locationInInfo" class="hidden p-4 bg-gray-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-2">Koordinat: <span id="coordsIn" class="font-mono"></span></p>
                                    <p class="text-sm text-gray-600 mb-2">Alamat: <span id="addressIn"></span></p>
                                    <div id="radiusStatusIn" class="p-3 rounded-lg text-sm font-medium"></div>
                                </div>
                                <div id="mapIn" class="hidden h-64 rounded-lg border bg-gray-100 flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-map-marker-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-500">Peta lokasi akan ditampilkan di sini</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reason for Outside Radius -->
                        <div id="outsideReasonIn" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Alasan Berada di Luar Radius Kantor *</label>
                            <textarea id="outsideReasonTextIn" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Jelaskan alasan Anda berada di luar radius kantor..."></textarea>
                        </div>

                        <!-- Late Reason -->
                        <div id="lateReasonSection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Alasan Terlambat *</label>
                            <textarea id="lateReasonText" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Jelaskan alasan keterlambatan Anda..."></textarea>
                        </div>

                        <div class="flex justify-center space-x-4">
                            <button type="button" onclick="hideClockInForm()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                <i class="fas fa-check mr-2"></i>Submit Absen Masuk
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Clock Out Form -->
                <div id="clockOutForm" class="hidden mt-8 border-t pt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6 text-center">Form Absen Pulang</h3>
                    <form id="attendanceOutForm" class="space-y-6">
                        <!-- Location Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Pulang *</label>
                            <div class="space-y-4">
                                <button type="button" onclick="getCurrentLocation('out')" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Dapatkan Lokasi Saat Ini
                                </button>
                                <div id="locationOutInfo" class="hidden p-4 bg-gray-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-2">Koordinat: <span id="coordsOut" class="font-mono"></span></p>
                                    <p class="text-sm text-gray-600 mb-2">Alamat: <span id="addressOut"></span></p>
                                    <div id="radiusStatusOut" class="p-3 rounded-lg text-sm font-medium"></div>
                                </div>
                                <div id="mapOut" class="hidden h-64 rounded-lg border bg-gray-100 flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-map-marker-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-500">Peta lokasi akan ditampilkan di sini</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reason for Outside Radius -->
                        <div id="outsideReasonOut" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Alasan Berada di Luar Radius Kantor *</label>
                            <textarea id="outsideReasonTextOut" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Jelaskan alasan Anda berada di luar radius kantor..."></textarea>
                        </div>

                        <!-- Work Report -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Laporan Pekerjaan Hari Ini *</label>
                            <textarea id="workReport" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="4" placeholder="Jelaskan pekerjaan yang telah Anda selesaikan hari ini..." required></textarea>
                        </div>

                        <!-- Work Photo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Foto Pekerjaan Hari Ini</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="workPhotoInput" accept="image/*" class="hidden" onchange="previewWorkPhoto(event)">
                                <img id="workPhotoPreview" class="hidden w-full max-w-sm mx-auto rounded-lg mb-4">
                                <div id="workPhotoControls">
                                    <button type="button" onclick="document.getElementById('workPhotoInput').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-image mr-2"></i>Pilih Foto dari Gallery
                                    </button>
                                    <p class="text-sm text-gray-500 mt-2">Format: JPG, PNG (Max 5MB)</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center space-x-4">
                            <button type="button" onclick="hideClockOutForm()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                <i class="fas fa-check mr-2"></i>Submit Absen Pulang
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Attendance Summary -->
                <div id="attendanceSummary" class="hidden mt-8 border-t pt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6 text-center">Ringkasan Absensi Hari Ini</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Status Absen</p>
                                <p id="attendanceStatusText" class="font-medium text-lg"></p>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Absen Masuk</p>
                                <p id="clockInTime" class="font-medium"></p>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Status Masuk</p>
                                <p id="clockInStatus" class="font-medium"></p>
                            </div>
                            <div id="clockOutTimeDiv" class="hidden p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Absen Pulang</p>
                                <p id="clockOutTime" class="font-medium"></p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div id="clockOutStatusDiv" class="hidden p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Status Pulang</p>
                                <p id="clockOutStatus" class="font-medium"></p>
                            </div>
                            <div id="overtimeDiv" class="hidden p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Total Overtime</p>
                                <p id="overtimeHours" class="font-medium"></p>
                            </div>
                            <div id="worktimeDiv" class="hidden p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">Total Waktu Kerja</p>
                                <p id="totalWorktime" class="font-medium"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <i class="fas fa-calendar-check text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Hadir Bulan Ini</p>
                            <p id="monthlyAttendance" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-lg">
                            <i class="fas fa-clock text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Jam Kerja</p>
                            <p id="monthlyWorkHours" class="text-2xl font-bold text-gray-800">0h</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-lg">
                            <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Terlambat</p>
                            <p id="monthlyLate" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="bg-white rounded-2xl card-shadow">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8 px-6">
                        <button onclick="showTab('history')" class="tab-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium" data-tab="history">
                            Riwayat Absen
                        </button>
                    </nav>
                </div>

                <!-- History Tab -->
                <div id="historyTab" class="p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Riwayat Absensi</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Tanggal</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Clock In</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Clock Out</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Status</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceHistory">
                                <tr id="noDataRow">
                                    <td colspan="4" class="py-8 px-4 text-center text-gray-500">
                                        <i class="fas fa-calendar-times text-4xl mb-2"></i>
                                        <p>Belum ada data absensi</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
        </main>
    </div>

    <!-- News Detail Modal -->
    <div id="newsDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl card-shadow w-full max-w-4xl mx-4 slide-in max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 id="newsDetailTitle" class="text-2xl font-bold text-gray-800">Detail Berita</h2>
                    <button onclick="hideNewsDetail()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div id="newsDetailContent" class="space-y-6">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Detail Modal -->
    <div id="attendanceDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl card-shadow w-full max-w-4xl mx-4 slide-in max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Detail Absensi</h2>
                    <button onclick="hideAttendanceDetail()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div id="attendanceDetailContent" class="space-y-6">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- News Management Modal -->
    <div id="newsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl card-shadow w-full max-w-2xl mx-4 slide-in max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 id="newsModalTitle" class="text-2xl font-bold text-gray-800">Tambah Berita</h2>
                    <button onclick="hideNewsModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <form id="newsForm" class="space-y-6">
                    <input type="hidden" id="newsId">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Berita *</label>
                        <input type="text" id="newsTitle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori *</label>
                        <select id="newsCategory" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                            <option value="">Pilih Kategori</option>
                            <option value="HR">HR</option>
                            <option value="Training">Training</option>
                            <option value="Announcement">Pengumuman</option>
                            <option value="Event">Event</option>
                            <option value="Policy">Kebijakan</option>
                            <option value="Safety">Keselamatan</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ringkasan *</label>
                        <textarea id="newsSummary" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" rows="3" placeholder="Ringkasan singkat berita..." required></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Konten Lengkap *</label>
                        <textarea id="newsContent" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" rows="8" placeholder="Tulis konten berita lengkap di sini..." required></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Foto Berita</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="newsImageInput" accept="image/*" class="hidden" onchange="previewNewsImage(event)">
                            <img id="newsImagePreview" class="hidden w-full max-w-sm mx-auto rounded-lg mb-4">
                            <div id="newsImageControls">
                                <button type="button" onclick="document.getElementById('newsImageInput').click()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                    <i class="fas fa-image mr-2"></i>Pilih Foto
                                </button>
                                <p class="text-sm text-gray-500 mt-2">Format: JPG, PNG (Max 5MB)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Penulis</label>
                        <input type="text" id="newsAuthor" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Nama penulis atau departemen">
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="newsActive" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500" checked>
                            <span class="ml-2 text-sm text-gray-700">Aktifkan berita</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="newsNotify" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                            <span class="ml-2 text-sm text-gray-700">Kirim notifikasi</span>
                        </label>
                    </div>
                    
                    <div class="flex justify-center space-x-4 pt-4">
                        <button type="button" onclick="hideNewsModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200">
                            Batal
                        </button>
                        <button type="submit" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition duration-200">
                            <i class="fas fa-save mr-2"></i>Simpan Berita
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Attendance Edit Modal -->
    <div id="adminAttendanceEditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl card-shadow w-full max-w-6xl mx-4 slide-in max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Edit Data Absensi</h2>
                    <button onclick="hideAdminAttendanceEdit()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <form id="adminAttendanceEditForm" class="space-y-8">
                    <input type="hidden" id="editAttendanceId">
                    
                    <!-- Employee Info (Read-only) -->
                    <div class="bg-gray-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informasi Karyawan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="editEmployeeName" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="editEmployeeEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Divisi</label>
                                <input type="text" id="editEmployeeDivision" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Posisi</label>
                                <input type="text" id="editEmployeePosition" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Clock In Section -->
                    <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-green-800 mb-4">Data Clock In</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal & Waktu Clock In</label>
                                    <input type="datetime-local" id="editClockInTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bertugas Sebagai</label>
                                    <select id="editDutyAs" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="Director">Director</option>
                                        <option value="Safety, Quality & Security Manager">Safety, Quality & Security Manager</option>
                                        <option value="Operation Manager">Operation Manager</option>
                                        <option value="Maintenance Manager">Maintenance Manager</option>
                                        <option value="Chief Pilot Fixed Wing">Chief Pilot Fixed Wing</option>
                                        <option value="Chief Pilot Rotary Wing">Chief Pilot Rotary Wing</option>
                                        <option value="Chief Flight Support">Chief Flight Support</option>
                                        <option value="Chief Inspector">Chief Inspector</option>
                                        <option value="Chief Engineer">Chief Engineer</option>
                                        <option value="Chief Finance, Accounting & Staf">Chief Finance, Accounting & Staf</option>
                                        <option value="Chief Engineering">Chief Engineering</option>
                                        <option value="Pilot in Command">Pilot in Command</option>
                                        <option value="Second in Command">Second in Command</option>
                                        <option value="Ground Instructor">Ground Instructor</option>
                                        <option value="Flight Instructor">Flight Instructor</option>
                                        <option value="Company Check Pilot">Company Check Pilot</option>
                                        <option value="Engineer">Engineer</option>
                                        <option value="Line Pilot">Line Pilot</option>
                                        <option value="Cabin Service">Cabin Service</option>
                                        <option value="Student">Student</option>
                                        <option value="Flight Support">Flight Support</option>
                                        <option value="Ground Support">Ground Support</option>
                                        <option value="Technical Representative">Technical Representative</option>
                                        <option value="Engineering">Engineering</option>
                                        <option value="Staff">Staff</option>
                                        <option value="Logistic">Logistic</option>
                                        <option value="Aviation Security">Aviation Security</option>
                                        <option value="Driver">Driver</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Pekerjaan</label>
                                    <select id="editWorkType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="Office Hour">Office Hour</option>
                                        <option value="Standby Flight">Standby Flight</option>
                                        <option value="Standby on Call">Standby on Call</option>
                                        <option value="Pos One Gate">Pos One Gate</option>
                                        <option value="Day Off">Day Off</option>
                                        <option value="Day Off 7 Consecutive Days for Pilot">Day Off 7 Consecutive Days for Pilot</option>
                                        <option value="Flight Duty VIP">Flight Duty VIP</option>
                                        <option value="Ferry Flight">Ferry Flight</option>
                                        <option value="PPC Simulator">PPC Simulator</option>
                                        <option value="PPC Aircraft">PPC Aircraft</option>
                                        <option value="Test Flight">Test Flight</option>
                                        <option value="Ground Run">Ground Run</option>
                                        <option value="Recurrent Training">Recurrent Training</option>
                                        <option value="Recency Flight">Recency Flight</option>
                                        <option value="Meeting Out of Office">Meeting Out of Office</option>
                                        <option value="Medical Examination">Medical Examination</option>
                                        <option value="Annual Leave">Annual Leave</option>
                                        <option value="Sick">Sick</option>
                                        <option value="Technical Representative">Technical Representative</option>
                                        <option value="Aviation Security">Aviation Security</option>
                                        <option value="Over Time">Over Time</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Clock In</label>
                                    <input type="text" id="editLocationIn" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 font-mono text-sm" placeholder="lat, lng">
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Radius Clock In</label>
                                    <select id="editRadiusStatusIn" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="true">Dalam Radius</option>
                                        <option value="false">Di Luar Radius</option>
                                    </select>
                                </div>
                                <div id="editOutsideReasonInDiv">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alasan di Luar Radius</label>
                                    <textarea id="editOutsideReasonIn" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" rows="3"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Keterlambatan</label>
                                    <select id="editLateStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="false">Tepat Waktu</option>
                                        <option value="true">Terlambat</option>
                                    </select>
                                </div>
                                <div id="editLateReasonDiv">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alasan Terlambat</label>
                                    <textarea id="editLateReason" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" rows="3"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foto Clock In</label>
                                    <div class="border border-gray-300 rounded-lg p-3">
                                        <img id="editPhotoIn" class="w-full max-w-xs rounded-lg" alt="Foto Clock In">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Clock Out Section -->
                    <div id="editClockOutSection" class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-red-800 mb-4">Data Clock Out</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal & Waktu Clock Out</label>
                                    <input type="datetime-local" id="editClockOutTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Clock Out</label>
                                    <input type="text" id="editLocationOut" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 font-mono text-sm" placeholder="lat, lng">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Radius Clock Out</label>
                                    <select id="editRadiusStatusOut" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                                        <option value="true">Dalam Radius</option>
                                        <option value="false">Di Luar Radius</option>
                                    </select>
                                </div>
                                <div id="editOutsideReasonOutDiv">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alasan di Luar Radius</label>
                                    <textarea id="editOutsideReasonOut" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Laporan Pekerjaan</label>
                                    <textarea id="editWorkReport" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" rows="4"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foto Pekerjaan</label>
                                    <div class="border border-gray-300 rounded-lg p-3">
                                        <img id="editPhotoOut" class="w-full max-w-xs rounded-lg hidden" alt="Foto Pekerjaan">
                                        <p id="editNoPhotoOut" class="text-gray-500 text-sm">Tidak ada foto pekerjaan</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin Notes -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-yellow-800 mb-4">Catatan Admin</h3>
                        <textarea id="editAdminNotes" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" rows="3" placeholder="Tambahkan catatan admin untuk perubahan ini..."></textarea>
                    </div>
                    
                    <div class="flex justify-center space-x-4 pt-4">
                        <button type="button" onclick="hideAdminAttendanceEdit()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200">
                            Batal
                        </button>
                        <button type="submit" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition duration-200">
                            <i class="fas fa-save mr-2"></i>Simpan Perubahan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md mx-4 slide-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Edit Profile</h2>
                <p class="text-gray-600">Update your profile information</p>
            </div>
            
            <form id="profileForm" class="space-y-6">
                <!-- Profile Photo Section -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-gray-300 mx-auto mb-4">
                            <img id="profilePhotoPreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236B7280'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Profile" class="w-full h-full object-cover">
                        </div>
                        <button type="button" onclick="document.getElementById('profilePhotoInput').click()" class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-camera text-sm"></i>
                        </button>
                    </div>
                    <input type="file" id="profilePhotoInput" accept="image/*" class="hidden" onchange="previewProfilePhoto(event)">
                    <p class="text-sm text-gray-500">Click camera icon to change photo</p>
                </div>
                
                <!-- Profile Info -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="profileName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="John Doe">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="profileEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="user@transwisata.com" readonly>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telepon</label>
                    <input type="tel" id="profilePhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="08xxxxxxxxxx">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Departemen</label>
                    <select id="profileDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="">Pilih Departemen</option>
                        <option value="IT">IT</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Operations">Operations</option>
                    </select>
                </div>
                
                <div class="flex justify-center space-x-4 pt-4">
                    <button type="button" onclick="hideProfileModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200">
                        Batal
                    </button>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200">
                        <i class="fas fa-save mr-2"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="bg-purple-600 w-8 h-8 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-cog text-white text-sm"></i>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-800">Admin Panel - ECrew</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Admin: <span class="font-medium">Administrator</span></span>
                        <button onclick="logout()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Admin Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Admin Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <i class="fas fa-users text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Total Karyawan</p>
                            <p id="totalEmployees" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-lg">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Hadir Hari Ini</p>
                            <p id="presentToday" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-lg">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Terlambat</p>
                            <p id="lateToday" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-red-100 p-3 rounded-lg">
                            <i class="fas fa-times-circle text-red-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Tidak Hadir</p>
                            <p id="absentToday" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Tabs -->
            <div class="bg-white rounded-2xl card-shadow">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8 px-6">
                        <button onclick="showAdminTab('news')" class="admin-tab-btn py-4 px-2 border-b-2 border-purple-500 text-purple-600 font-medium" data-tab="news">
                            Kelola Berita
                        </button>
                        <button onclick="showAdminTab('employees')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="employees">
                            Data Karyawan
                        </button>
                        <button onclick="showAdminTab('attendance')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="attendance">
                            Riwayat Absen
                        </button>
                        <button onclick="showAdminTab('branding')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="branding">
                            Logo & Branding
                        </button>
                        <button onclick="showAdminTab('reports')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="reports">
                            Laporan Absensi
                        </button>
                        <button onclick="showAdminTab('settings')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="settings">
                            Pengaturan
                        </button>
                    </nav>
                </div>

                <!-- News Management Tab -->
                <div id="newsTab" class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Kelola Berita</h3>
                        <button onclick="showAddNewsModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Tambah Berita
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Judul</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Kategori</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Tanggal</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Status</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Notifikasi</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="newsTableBody">
                                <!-- News will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Attendance History Tab -->
                <div id="attendanceTab" class="p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Riwayat Absen Karyawan</h3>
                        <div class="flex items-center space-x-4">
                            <!-- Filter Controls -->
                            <div class="flex items-center space-x-2">
                                <input type="text" id="attendanceNameFilter" placeholder="Cari nama karyawan..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm">
                                
                                <select id="attendancePeriodFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm">
                                    <option value="daily">Harian</option>
                                    <option value="weekly">Mingguan</option>
                                    <option value="monthly">Bulanan</option>
                                </select>
                                
                                <input type="date" id="attendanceDateFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm">
                                
                                <button onclick="applyAttendanceFilter()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200 text-sm">
                                    <i class="fas fa-filter mr-1"></i>Apply
                                </button>
                                
                                <button onclick="resetAttendanceFilter()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200 text-sm">
                                    <i class="fas fa-undo mr-1"></i>Reset
                                </button>
                                
                                <button onclick="downloadAttendancePDF()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 text-sm">
                                    <i class="fas fa-download mr-1"></i>Download PDF
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filter Summary -->
                    <div id="attendanceFilterSummary" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg hidden">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-800" id="filterSummaryText"></span>
                            <span class="text-sm font-medium text-blue-900" id="filterResultCount"></span>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Nama</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Tanggal</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Clock In</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Clock Out</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Status</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Lokasi</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceHistoryTableBody">
                                <tr id="noAttendanceDataRow">
                                    <td colspan="7" class="py-8 px-4 text-center text-gray-500">
                                        <i class="fas fa-calendar-times text-4xl mb-2"></i>
                                        <p>Belum ada data absensi</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Employees Tab -->
                <div id="employeesTab" class="p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Data Karyawan</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="employeeSearch" placeholder="Cari karyawan..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <button onclick="searchEmployees()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Nama</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Email</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Divisi</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Posisi</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-600">Status</th>
                                </tr>
                            </thead>
                            <tbody id="employeeTableBody">
                                <!-- Employee data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Branding Tab -->
                <div id="brandingTab" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-6">Logo & Branding</h3>
                    
                    <div class="space-y-8">
                        <!-- Logo Upload Section -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-md font-semibold text-gray-800 mb-4">Logo Aplikasi</h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Current Logo Preview -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo Saat Ini</label>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                        <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" id="currentLogoPreview">
                                            <img src="" alt="Current Logo" class="w-10 h-10 object-contain hidden" id="currentLogoImg">
                                            <i class="fas fa-users text-white text-2xl" id="currentLogoIcon"></i>
                                        </div>
                                        <p class="text-sm text-gray-600">Preview logo saat ini</p>
                                    </div>
                                </div>
                                
                                <!-- Logo Upload -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload Logo Baru</label>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                        <input type="file" id="logoUpload" accept="image/*" class="hidden" onchange="previewLogo(event)">
                                        <img id="logoPreview" class="hidden w-16 h-16 object-contain mx-auto mb-4 rounded">
                                        <div id="logoUploadControls">
                                            <button type="button" onclick="document.getElementById('logoUpload').click()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 mb-2">
                                                <i class="fas fa-upload mr-2"></i>Pilih Logo
                                            </button>
                                            <p class="text-sm text-gray-500">Format: PNG, JPG, SVG (Max 2MB)</p>
                                            <p class="text-xs text-gray-400 mt-1">Rekomendasi: 64x64px atau rasio 1:1</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- App Title Section -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-md font-semibold text-gray-800 mb-4">Judul Aplikasi</h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Judul Utama</label>
                                    <input type="text" id="appTitle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ECrew Absensi">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subtitle</label>
                                    <input type="text" id="appSubtitle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Transwisata Employee System">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preview Section -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-md font-semibold text-gray-800 mb-4">Preview Halaman Login</h4>
                            
                            <div class="bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg p-8 flex items-center justify-center">
                                <div class="bg-white rounded-xl p-6 w-full max-w-sm">
                                    <div class="text-center mb-6">
                                        <div class="bg-blue-600 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3" id="previewLogo">
                                            <img src="" alt="Preview Logo" class="w-8 h-8 object-contain hidden" id="previewLogoImg">
                                            <i class="fas fa-users text-white text-lg" id="previewLogoIcon"></i>
                                        </div>
                                        <h1 class="text-lg font-bold text-gray-800 mb-1" id="previewTitle">ECrew Absensi</h1>
                                        <p class="text-sm text-gray-600" id="previewSubtitle">Transwisata Employee System</p>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="h-8 bg-gray-100 rounded"></div>
                                        <div class="h-8 bg-gray-100 rounded"></div>
                                        <div class="h-8 bg-blue-600 rounded"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex justify-center space-x-4">
                            <button onclick="resetBranding()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200">
                                <i class="fas fa-undo mr-2"></i>Reset ke Default
                            </button>
                            <button onclick="saveBranding()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition duration-200">
                                <i class="fas fa-save mr-2"></i>Simpan Perubahan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reportsTab" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Laporan Absensi</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">Laporan Harian</h4>
                            <p class="text-sm text-gray-600 mb-4">Lihat absensi karyawan hari ini</p>
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-download mr-2"></i>Download
                            </button>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">Laporan Bulanan</h4>
                            <p class="text-sm text-gray-600 mb-4">Rekap absensi bulan ini</p>
                            <button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                <i class="fas fa-download mr-2"></i>Download
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengaturan Sistem</h3>
                    <div class="space-y-6">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">Jam Kerja</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Jam Masuk</label>
                                    <input type="time" value="08:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Jam Pulang</label>
                                    <input type="time" value="17:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-2">Toleransi Keterlambatan</h4>
                            <input type="number" value="15" class="w-32 px-3 py-2 border border-gray-300 rounded-lg">
                            <span class="text-sm text-gray-600 ml-2">menit</span>
                        </div>
                        <button class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                            Simpan Pengaturan
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let isLoggedIn = false;
        let clockedIn = false;
        let clockInTime = null;
        let clockOutTime = null;
        let currentStream = null;
        let attendanceData = {
            clockIn: null,
            clockOut: null,
            locationIn: null,
            locationOut: null,
            photo: null,
            workPhoto: null
        };

        // App settings
        let appSettings = {
            logo: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"%3E%3Cpath d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/%3E%3C/svg%3E',
            title: 'ECrew Absensi',
            subtitle: 'Transwisata Employee System'
        };

        // News database
        let newsDatabase = [
            {
                id: 1,
                title: "Program Bonus Kinerja",
                summary: "Peluncuran program bonus kinerja untuk karyawan berprestasi dengan total hadiah hingga 50 juta rupiah.",
                content: "Transwisata dengan bangga mengumumkan peluncuran Program Bonus Kinerja yang dirancang khusus untuk menghargai dedikasi dan prestasi luar biasa karyawan kami. Program ini menawarkan total hadiah hingga 50 juta rupiah yang akan didistribusikan kepada karyawan berprestasi berdasarkan evaluasi kinerja komprehensif.\n\nKriteria penilaian meliputi:\n• Pencapaian target kerja\n• Inovasi dan kreativitas\n• Kerjasama tim\n• Kepemimpinan\n• Kontribusi terhadap perusahaan\n\nPendaftaran dibuka mulai 15 Januari 2024 dan akan ditutup pada 15 Februari 2024. Penilaian akan dilakukan oleh tim evaluasi independen yang terdiri dari manajemen senior dan HR.\n\nJangan lewatkan kesempatan emas ini untuk mendapatkan pengakuan atas kerja keras Anda!",
                date: "2024-01-12",
                author: "HR Department",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 200' fill='%23f3f4f6'%3E%3Crect width='400' height='200' fill='%23e5e7eb'/%3E%3Ctext x='200' y='100' text-anchor='middle' dy='.3em' fill='%236b7280' font-family='Arial' font-size='16'%3EBonus Program%3C/text%3E%3C/svg%3E",
                category: "HR",
                isActive: true,
                isNotified: true
            },
            {
                id: 2,
                title: "Pelatihan Digital Marketing",
                summary: "Pendaftaran pelatihan digital marketing gratis untuk semua karyawan. Daftar sekarang!",
                content: "Dalam era digital yang terus berkembang, Transwisata berkomitmen untuk meningkatkan kemampuan digital seluruh karyawan melalui Program Pelatihan Digital Marketing yang komprehensif dan gratis.\n\nMateri pelatihan mencakup:\n• Strategi Digital Marketing Modern\n• Social Media Management\n• Content Creation & Copywriting\n• SEO & SEM Fundamentals\n• Analytics & Performance Measurement\n• Email Marketing Campaigns\n\nPelatihan akan dilaksanakan selama 5 hari (20-24 Januari 2024) dengan instruktur berpengalaman dari industri digital marketing terkemuka. Setiap peserta akan mendapatkan sertifikat resmi yang diakui industri.\n\nKuota terbatas hanya 30 peserta. Pendaftaran ditutup pada 18 Januari 2024 atau sampai kuota penuh. Daftarkan diri Anda segera melalui portal HR atau hubungi bagian HRD.",
                date: "2024-01-10",
                author: "Training Department",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 200' fill='%23f3f4f6'%3E%3Crect width='400' height='200' fill='%23ddd6fe'/%3E%3Ctext x='200' y='100' text-anchor='middle' dy='.3em' fill='%237c3aed' font-family='Arial' font-size='16'%3EDigital Training%3C/text%3E%3C/svg%3E",
                category: "Training",
                isActive: true,
                isNotified: true
            }
        ];

        let nextNewsId = 3;

        // Attendance database - stores all employee attendance records
        let attendanceDatabase = [];

        let nextAttendanceId = 1;

        // Employee database
        const employeeDatabase = {
            "Rustam Suhanda": {
                email: "managementtranswisata@gmail.com",
                division: "Staf",
                position: "President Director",
                role: "USER",
                password: "rustam"
            },
            "Selfy Warauw": {
                email: "warauw_1@yahoo.com",
                division: "Staf",
                position: "Director",
                role: "USER",
                password: "selfy"
            },
            "Muhamad Ramdani Masri": {
                email: "crunkbolcow@gmail.com",
                division: "Operation",
                position: "Chief Pilot Rotary Wing",
                role: "USER",
                password: "muhamad"
            },
            "Sulaksono Teddy Prabowo": {
                email: "fly5103@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "sulaksono"
            },
            "Marcelino Bhaharoenawanto": {
                email: "marcelino412ep@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "marcelino"
            },
            "Muhamad Sofwan": {
                email: "sofwanm819@gmail.com",
                division: "Operation",
                position: "Chief Pilot Fixed Wing",
                role: "USER",
                password: "muhamad"
            },
            "Sofian M. L. Tobing": {
                email: "sofiantobing692@gmail.com",
                division: "Operation",
                position: "General Manager",
                role: "USER",
                password: "sofian"
            },
            "Rico Febdiandana": {
                email: "ricofebdi@gmail.com",
                division: "Operation",
                position: "Chief Flight Support",
                role: "USER",
                password: "rico"
            },
            "Alfajri": {
                email: "alfajri_koto@yahoo.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "alfajri"
            },
            "Eli Setya": {
                email: "tioxpilot@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "eli"
            },
            "Susetyo Harijanto": {
                email: "harijantosusetyo@gmail.com",
                division: "Operation",
                position: "Operation Manager",
                role: "USER",
                password: "susetyo"
            },
            "Purwoko": {
                email: "purwoko.mulyono@yahoo.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "purwoko"
            },
            "Riza Hanindita": {
                email: "icul2122@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "riza"
            },
            "Henaldy Arifia Sudrajat": {
                email: "henaldy.ts204@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "henaldy"
            },
            "Kadek Amelia Nadya Berliana": {
                email: "amelberliana@yahoo.co.id",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "kadek"
            },
            "Qorry Maulidya Natawijaya": {
                email: "qnatawijaya@gmail.com",
                division: "Operation",
                position: "Cabin Service",
                role: "USER",
                password: "qorry"
            },
            "Shentira Anggia Putri": {
                email: "anggiashentira@gmail.com",
                division: "Operation",
                position: "Cabin Service",
                role: "USER",
                password: "shentira"
            },
            "Tiffani Pricilia Hasan": {
                email: "tiffanipriciliaaaa@gmail.com",
                division: "Operation",
                position: "Cabin Service",
                role: "USER",
                password: "tiffani"
            },
            "Agustin Zulfani Prihatini": {
                email: "agustinzulfani74@gmail.com",
                division: "Operation",
                position: "Cabin Service",
                role: "USER",
                password: "agustin"
            },
            "Nadya Casey Ivanka": {
                email: "ivankacasey99@gmail.com",
                division: "Operation",
                position: "Cabin Service",
                role: "USER",
                password: "nadya"
            },
            "Yanu Prihatno": {
                email: "prihatnoyanu@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "yanu"
            },
            "Bayu Nugroho": {
                email: "bayu.avicena@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "bayu"
            },
            "Wahyudi Suseno": {
                email: "nawawahyudisuseno090@gmail.com",
                division: "Maintenance",
                position: "Avionic",
                role: "USER",
                password: "wahyudi"
            },
            "Sigit Hardadi": {
                email: "sigithardadi88@yahoo.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "sigit"
            },
            "Hadi Sutrisno": {
                email: "hadikamilatun@gmail.com",
                division: "Maintenance",
                position: "Maintenance Manager",
                role: "USER",
                password: "hadi"
            },
            "Suhairi": {
                email: "suhairitwa@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "suhairi"
            },
            "Suyanto": {
                email: "yanto.umardin@gmail.com",
                division: "Maintenance",
                position: "Avionic",
                role: "USER",
                password: "suyanto"
            },
            "Lazarus Rio Raymond": {
                email: "rioraymond89@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "lazarus"
            },
            "Febie Aguti Effendi": {
                email: "mpiipie@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "febie"
            },
            "Diki Hariyanto": {
                email: "dikiatnu7@gmail.com",
                division: "Maintenance",
                position: "Chief Engineer",
                role: "USER",
                password: "diki"
            },
            "Prayit Susonggo": {
                email: "prayitsusonggo@yahoo.com",
                division: "Maintenance",
                position: "Avionic",
                role: "USER",
                password: "prayit"
            },
            "Iskandar Akbar Hakim": {
                email: "iskandarakbarhakim@gmail.com",
                division: "Maintenance",
                position: "Chief Inspector",
                role: "USER",
                password: "iskandar"
            },
            "Arif Vrybadi Halim": {
                email: "GlexXRSvpcgo@outlook.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "arif"
            },
            "Alfiza Eka Putra": {
                email: "alfizaekap@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "alfiza"
            },
            "Dedi Prasetyo": {
                email: "deditren99@gmail.com",
                division: "Safety",
                position: "Aviation Security",
                role: "USER",
                password: "dedi"
            },
            "Media H Marbun": {
                email: "mediamarbun@gmail.com",
                division: "Staf",
                position: "Human Resource Development",
                role: "USER",
                password: "media"
            },
            "Fatmawati": {
                email: "ulieumeda@gmail.com",
                division: "Staf",
                position: "Finance",
                role: "USER",
                password: "fatmawati"
            },
            "Dede Rahman Arafiq": {
                email: "d2rahman@yahoo.co.id",
                division: "Staf",
                position: "Finance",
                role: "USER",
                password: "dede"
            },
            "Leo Fitzgerald Sinay": {
                email: "leosinay@gmail.com",
                division: "Maintenance",
                position: "Chief Engineering",
                role: "USER",
                password: "leo"
            },
            "Khairul Zaman Pohan": {
                email: "pohan16zaman@gmail.com",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "khairul"
            },
            "Sentot Basuki": {
                email: "sentotbasuki@gmail.com",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "sentot"
            },
            "Bobby Feisal Mahardhika": {
                email: "bobby.feisal22@gmail.com",
                division: "Staf",
                position: "Engineering",
                role: "USER",
                password: "bobby"
            },
            "Tri Widayat": {
                email: "tri3wiwid@gmail.com",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "tri"
            },
            "Isdarminto": {
                email: "is.darminto35@gmail.com",
                division: "Staf",
                position: "Logistic",
                role: "USER",
                password: "isdarminto"
            },
            "Sulaichan Noor Ali": {
                email: "sulaichann@gmail.com",
                division: "Staf",
                position: "Logistic",
                role: "USER",
                password: "sulaichan"
            },
            "Sri Muljono Bayu Putro": {
                email: "sbayuputro@gmail.com",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "sri"
            },
            "Asri Gatot Yulianto": {
                email: "Asrigatot.67@gmail.com",
                division: "Safety",
                position: "Aviation Security",
                role: "USER",
                password: "asri"
            },
            "Nanang Chabibi": {
                email: "nanangchabibi3@gmail.com",
                division: "Safety",
                position: "Aviation Security",
                role: "USER",
                password: "nanang"
            },
            "Hariyanto": {
                email: "katellisna423@gmail.com",
                division: "Safety",
                position: "Aviation Security",
                role: "USER",
                password: "hariyanto"
            },
            "Supriyono": {
                email: "fardhan0509@gmail.com",
                division: "Staf",
                position: "Kurir",
                role: "USER",
                password: "supriyono"
            },
            "Kasna": {
                email: "kasna.pjln799@gmail.com",
                division: "Staf",
                position: "Driver",
                role: "USER",
                password: "kasna"
            },
            "Rizal Setiawan": {
                email: "rizalsetiawan020812@gmail.com",
                division: "Staf",
                position: "Driver",
                role: "USER",
                password: "rizal"
            },
            "Ardi Rizki": {
                email: "ardi.rizk91@gmail.com",
                division: "Maintenance",
                position: "Engineer",
                role: "USER",
                password: "ardi"
            },
            "Wawan Setiawan": {
                email: "setiawanwawan7312@gmail.com",
                division: "Operation",
                position: "Line Pilot",
                role: "USER",
                password: "wawan"
            },
            "Tommy Saputra": {
                email: "tommysaputra473@gmail.com",
                division: "Staf",
                position: "Chief Finance, Accounting & Tax",
                role: "USER",
                password: "tommy"
            },
            "Mochamad Riza": {
                email: "mch_riza@yahoo.com",
                division: "Safety",
                position: "Quality, Safety, Security Manager",
                role: "USER",
                password: "mochamad"
            },
            "Alexander Anggarda Yunan Devata": {
                email: "alexanderdevata@yahoo.co.id",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "alexander"
            },
            "Sukyono": {
                email: "sskkyy020@gmail.com",
                division: "Operation",
                position: "Flight Support",
                role: "USER",
                password: "sukyono"
            }
        };

        // Office coordinates for radius check
        const officeLocations = [
            { lat: -6.267716, lng: 106.897317 },
            { lat: -6.265146, lng: 106.885701 }
        ];
        const radiusMeters = 250;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            setupFormHandlers();
            setupAutoFill();
            loadNews();
            updateNewsTicker();
            loadBrandingSettings();
        });

        // Setup auto-fill functionality (no longer needed as fields are auto-filled on login)
        function setupAutoFill() {
            // This function is kept for compatibility but no longer used
            // Fields are now auto-filled based on logged-in user
        }

        // Update current time
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            const dateElement = document.getElementById('currentDate');
            
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('id-ID');
            }
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('id-ID', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        }

        // Setup form handlers
        function setupFormHandlers() {
            // Clock In Form Handler
            document.getElementById('attendanceInForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitClockIn();
            });

            // Clock Out Form Handler
            document.getElementById('attendanceOutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitClockOut();
            });
        }

        // Calculate distance between two coordinates
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI/180;
            const φ2 = lat2 * Math.PI/180;
            const Δφ = (lat2-lat1) * Math.PI/180;
            const Δλ = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        // Check if location is within office radius
        function isWithinOfficeRadius(lat, lng) {
            for (let office of officeLocations) {
                const distance = calculateDistance(lat, lng, office.lat, office.lng);
                if (distance <= radiusMeters) {
                    return true;
                }
            }
            return false;
        }

        // Show Clock In Form
        function showClockInForm() {
            document.getElementById('clockInForm').classList.remove('hidden');
            document.getElementById('clockInBtn').disabled = true;
            
            // Auto-fill form with current user data
            if (currentUser) {
                document.getElementById('employeeName').value = currentUser.name || '';
                document.getElementById('employeeEmail').value = currentUser.email || '';
                document.getElementById('employeeDivision').value = currentUser.division || '';
                document.getElementById('employeePosition').value = currentUser.position || '';
                
                // Make these fields readonly since they're auto-filled
                document.getElementById('employeeName').readOnly = true;
                document.getElementById('employeeEmail').readOnly = true;
                document.getElementById('employeeDivision').readOnly = true;
                document.getElementById('employeePosition').readOnly = true;
                
                // Add visual indication that fields are auto-filled
                document.getElementById('employeeName').classList.add('bg-gray-100');
                document.getElementById('employeeEmail').classList.add('bg-gray-100');
                document.getElementById('employeeDivision').classList.add('bg-gray-100');
                document.getElementById('employeePosition').classList.add('bg-gray-100');
            }
        }

        // Hide Clock In Form
        function hideClockInForm() {
            document.getElementById('clockInForm').classList.add('hidden');
            document.getElementById('clockInBtn').disabled = false;
            stopCamera();
            
            // Reset form fields styling
            document.getElementById('employeeName').classList.remove('bg-gray-100');
            document.getElementById('employeeEmail').classList.remove('bg-gray-100');
            document.getElementById('employeeDivision').classList.remove('bg-gray-100');
            document.getElementById('employeePosition').classList.remove('bg-gray-100');
            
            // Reset readonly status
            document.getElementById('employeeName').readOnly = false;
            document.getElementById('employeeEmail').readOnly = false;
            document.getElementById('employeeDivision').readOnly = false;
            document.getElementById('employeePosition').readOnly = false;
        }

        // Show Clock Out Form
        function showClockOutForm() {
            document.getElementById('clockOutForm').classList.remove('hidden');
            document.getElementById('clockOutBtn').disabled = true;
        }

        // Hide Clock Out Form
        function hideClockOutForm() {
            document.getElementById('clockOutForm').classList.add('hidden');
            document.getElementById('clockOutBtn').disabled = false;
        }

        // Start Camera
        async function startCamera() {
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                const video = document.getElementById('cameraPreview');
                video.srcObject = currentStream;
                video.classList.remove('hidden');
                video.play();
                
                document.getElementById('captureBtn').classList.remove('hidden');
            } catch (error) {
                alert('Tidak dapat mengakses kamera. Pastikan Anda memberikan izin kamera.');
            }
        }

        // Capture Photo
        function capturePhoto() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.getElementById('photoCanvas');
            const img = document.getElementById('capturedPhoto');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const dataURL = canvas.toDataURL('image/jpeg');
            img.src = dataURL;
            img.classList.remove('hidden');
            
            video.classList.add('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('retakeBtn').classList.remove('hidden');
            
            attendanceData.photo = dataURL;
            stopCamera();
        }

        // Retake Photo
        function retakePhoto() {
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('retakeBtn').classList.add('hidden');
            attendanceData.photo = null;
            startCamera();
        }

        // Stop Camera
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        // Get Current Location
        function getCurrentLocation(type) {
            if (!navigator.geolocation) {
                alert('Geolocation tidak didukung oleh browser ini.');
                return;
            }

            const button = document.querySelector(`button[onclick="getCurrentLocation('${type}')"]`);
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Mendapatkan Lokasi...';
            button.disabled = true;

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Store location data
                    if (type === 'in') {
                        attendanceData.locationIn = { lat, lng };
                    } else {
                        attendanceData.locationOut = { lat, lng };
                    }
                    
                    // Display location info
                    displayLocationInfo(lat, lng, type);
                    
                    // Reset button
                    button.innerHTML = '<i class="fas fa-map-marker-alt mr-2"></i>Lokasi Berhasil Didapat';
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-green-600', 'hover:bg-green-700');
                },
                (error) => {
                    alert('Tidak dapat mendapatkan lokasi. Pastikan GPS aktif dan berikan izin lokasi.');
                    button.innerHTML = '<i class="fas fa-map-marker-alt mr-2"></i>Dapatkan Lokasi Saat Ini';
                    button.disabled = false;
                }
            );
        }

        // Display Location Info
        async function displayLocationInfo(lat, lng, type) {
            const coordsElement = document.getElementById(`coords${type === 'in' ? 'In' : 'Out'}`);
            const addressElement = document.getElementById(`address${type === 'in' ? 'In' : 'Out'}`);
            const radiusElement = document.getElementById(`radiusStatus${type === 'in' ? 'In' : 'Out'}`);
            const infoElement = document.getElementById(`location${type === 'in' ? 'In' : 'Out'}Info`);
            const reasonElement = document.getElementById(`outsideReason${type === 'in' ? 'In' : 'Out'}`);
            const mapElement = document.getElementById(`map${type === 'in' ? 'In' : 'Out'}`);
            
            // Display coordinates
            coordsElement.textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            
            // Get address using reverse geocoding (simplified)
            addressElement.textContent = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
            
            // Check radius
            const withinRadius = isWithinOfficeRadius(lat, lng);
            
            if (withinRadius) {
                radiusElement.textContent = 'Anda berada dalam radius kantor';
                radiusElement.className = 'p-3 rounded-lg text-sm font-medium bg-green-100 text-green-800';
                reasonElement.classList.add('hidden');
            } else {
                radiusElement.textContent = 'Anda berada di luar radius kantor';
                radiusElement.className = 'p-3 rounded-lg text-sm font-medium bg-red-100 text-red-800';
                reasonElement.classList.remove('hidden');
            }
            
            // Display map
            displayMap(lat, lng, type, withinRadius);
            
            infoElement.classList.remove('hidden');
        }

        // Display map with location marker
        function displayMap(lat, lng, type, withinRadius) {
            const mapElement = document.getElementById(`map${type === 'in' ? 'In' : 'Out'}`);
            
            // Create a simple visual map representation
            const mapHTML = `
                <div class="relative w-full h-full bg-blue-50 rounded-lg overflow-hidden">
                    <!-- Map background -->
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-100 to-green-100"></div>
                    
                    <!-- Grid lines for map effect -->
                    <div class="absolute inset-0 opacity-20">
                        <div class="grid grid-cols-8 grid-rows-6 h-full">
                            ${Array(48).fill().map(() => '<div class="border border-gray-300"></div>').join('')}
                        </div>
                    </div>
                    
                    <!-- Office locations -->
                    ${officeLocations.map((office, index) => `
                        <div class="absolute w-4 h-4 bg-blue-600 rounded-full border-2 border-white shadow-lg transform -translate-x-2 -translate-y-2" 
                             style="left: ${30 + index * 20}%; top: ${40 + index * 10}%;" 
                             title="Kantor ${index + 1}">
                            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap">
                                Kantor ${index + 1}
                            </div>
                        </div>
                    `).join('')}
                    
                    <!-- Office radius circles -->
                    ${officeLocations.map((office, index) => `
                        <div class="absolute border-2 border-blue-300 rounded-full opacity-30" 
                             style="left: ${25 + index * 20}%; top: ${35 + index * 10}%; width: 60px; height: 60px;">
                        </div>
                    `).join('')}
                    
                    <!-- User location marker -->
                    <div class="absolute w-6 h-6 transform -translate-x-3 -translate-y-3" 
                         style="left: 50%; top: 50%;">
                        <div class="w-full h-full ${withinRadius ? 'bg-green-500' : 'bg-red-500'} rounded-full border-3 border-white shadow-lg animate-pulse">
                        </div>
                        <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 ${withinRadius ? 'bg-green-600' : 'bg-red-600'} text-white text-xs px-2 py-1 rounded whitespace-nowrap">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            ${withinRadius ? 'Dalam Radius' : 'Luar Radius'}
                        </div>
                    </div>
                    
                    <!-- Coordinates display -->
                    <div class="absolute bottom-2 left-2 bg-white bg-opacity-90 px-2 py-1 rounded text-xs font-mono">
                        ${lat.toFixed(4)}, ${lng.toFixed(4)}
                    </div>
                    
                    <!-- Distance info -->
                    <div class="absolute bottom-2 right-2 bg-white bg-opacity-90 px-2 py-1 rounded text-xs">
                        ${withinRadius ? 'Dalam radius kantor' : 'Di luar radius kantor'}
                    </div>
                </div>
            `;
            
            mapElement.innerHTML = mapHTML;
            mapElement.classList.remove('hidden');
            mapElement.classList.remove('flex', 'items-center', 'justify-center');
        }

        // Preview Work Photo
        function previewWorkPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar. Maksimal 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('workPhotoPreview');
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    attendanceData.workPhoto = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Submit Clock In
        function submitClockIn() {
            const now = new Date();
            
            // Validate required fields
            if (!attendanceData.photo) {
                alert('Foto masuk wajib diambil!');
                return;
            }
            
            if (!attendanceData.locationIn) {
                alert('Lokasi masuk wajib diisi!');
                return;
            }
            
            // Check if outside radius and reason is required
            const withinRadius = isWithinOfficeRadius(attendanceData.locationIn.lat, attendanceData.locationIn.lng);
            if (!withinRadius) {
                const reason = document.getElementById('outsideReasonTextIn').value.trim();
                if (!reason) {
                    alert('Alasan berada di luar radius kantor wajib diisi!');
                    return;
                }
            }
            
            // Check if late and reason is required
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const isLate = currentHour > 9 || (currentHour === 9 && currentMinute > 0);
            
            if (isLate) {
                const lateReason = document.getElementById('lateReasonText').value.trim();
                if (!lateReason) {
                    document.getElementById('lateReasonSection').classList.remove('hidden');
                    alert('Alasan terlambat wajib diisi!');
                    return;
                }
            }
            
            // Store clock in data
            clockInTime = now;
            attendanceData.clockIn = {
                time: now,
                name: document.getElementById('employeeName').value,
                email: document.getElementById('employeeEmail').value,
                division: document.getElementById('employeeDivision').value,
                position: document.getElementById('employeePosition').value,
                dutyAs: document.getElementById('dutyAs').value,
                workType: document.getElementById('workType').value,
                location: attendanceData.locationIn,
                photo: attendanceData.photo,
                withinRadius: withinRadius,
                outsideReason: withinRadius ? null : document.getElementById('outsideReasonTextIn').value,
                isLate: isLate,
                lateReason: isLate ? document.getElementById('lateReasonText').value : null
            };
            
            // Update UI
            clockedIn = true;
            document.getElementById('clockInBtn').disabled = true;
            document.getElementById('clockOutBtn').disabled = false;
            document.getElementById('clockOutBtn').classList.remove('opacity-50');
            
            // Hide form and show summary
            hideClockInForm();
            showAttendanceSummary();
            
            // Add to history
            addAttendanceRecord();
            
            alert('Absen masuk berhasil!');
        }

        // Submit Clock Out
        function submitClockOut() {
            const now = new Date();
            
            // Validate required fields
            if (!attendanceData.locationOut) {
                alert('Lokasi pulang wajib diisi!');
                return;
            }
            
            const workReport = document.getElementById('workReport').value.trim();
            if (!workReport) {
                alert('Laporan pekerjaan hari ini wajib diisi!');
                return;
            }
            
            // Check if outside radius and reason is required
            const withinRadius = isWithinOfficeRadius(attendanceData.locationOut.lat, attendanceData.locationOut.lng);
            if (!withinRadius) {
                const reason = document.getElementById('outsideReasonTextOut').value.trim();
                if (!reason) {
                    alert('Alasan berada di luar radius kantor wajib diisi!');
                    return;
                }
            }
            
            // Store clock out data
            clockOutTime = now;
            attendanceData.clockOut = {
                time: now,
                location: attendanceData.locationOut,
                withinRadius: withinRadius,
                outsideReason: withinRadius ? null : document.getElementById('outsideReasonTextOut').value,
                workReport: workReport,
                workPhoto: attendanceData.workPhoto
            };
            
            // Update UI
            clockedIn = false;
            document.getElementById('clockOutBtn').disabled = true;
            document.getElementById('clockOutBtn').classList.add('opacity-50');
            
            // Hide form and update summary
            hideClockOutForm();
            updateAttendanceSummary();
            
            // Update history
            updateLastAttendanceRecord();
            
            alert('Absen pulang berhasil!');
        }

        // Show Attendance Summary
        function showAttendanceSummary() {
            const summary = document.getElementById('attendanceSummary');
            const now = clockInTime;
            
            // Status Absen
            document.getElementById('attendanceStatusText').textContent = 'On Working';
            document.getElementById('attendanceStatusText').className = 'font-medium text-lg text-green-600';
            
            // Clock In Time
            document.getElementById('clockInTime').textContent = now.toLocaleDateString('id-ID') + ' ' + now.toLocaleTimeString('id-ID');
            
            // Clock In Status
            const isLate = now.getHours() > 9 || (now.getHours() === 9 && now.getMinutes() > 0);
            const statusText = isLate ? 'Anda Terlambat Absen' : 'Terima Kasih Anda Telah Absen Tepat Waktu';
            const statusClass = isLate ? 'font-medium text-red-600' : 'font-medium text-green-600';
            
            document.getElementById('clockInStatus').textContent = statusText;
            document.getElementById('clockInStatus').className = statusClass;
            
            summary.classList.remove('hidden');
        }

        // Update Attendance Summary
        function updateAttendanceSummary() {
            const now = clockOutTime;
            const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Status Absen
            document.getElementById('attendanceStatusText').textContent = 'Pulang';
            document.getElementById('attendanceStatusText').className = 'font-medium text-lg text-blue-600';
            
            // Clock Out Time
            document.getElementById('clockOutTime').textContent = now.toLocaleDateString('id-ID') + ' ' + now.toLocaleTimeString('id-ID');
            document.getElementById('clockOutTimeDiv').classList.remove('hidden');
            
            // Clock Out Status based on day of week
            const hour = now.getHours();
            const minute = now.getMinutes();
            let outStatus, outClass;
            
            if (dayOfWeek === 0) { // Sunday - no time restrictions
                outStatus = 'Anda Pulang Tepat Waktu (Hari Minggu)';
                outClass = 'font-medium text-green-600';
            } else if (dayOfWeek === 6) { // Saturday - different schedule
                if (hour < 14 || (hour === 14 && minute < 30)) {
                    outStatus = 'Anda Pulang Sebelum Waktunya';
                    outClass = 'font-medium text-yellow-600';
                } else if (hour === 14 && minute >= 30 && minute <= 45) {
                    outStatus = 'Anda Pulang Tepat Waktu';
                    outClass = 'font-medium text-green-600';
                } else {
                    outStatus = 'Waktu Kerja Melebihi';
                    outClass = 'font-medium text-blue-600';
                    
                    // Calculate overtime for Saturday (after 14:46)
                    const overtimeStart = new Date(now);
                    overtimeStart.setHours(14, 46, 0, 0);
                    const overtimeMs = now.getTime() - overtimeStart.getTime();
                    const overtimeHours = Math.floor(overtimeMs / (1000 * 60 * 60));
                    const overtimeMinutes = Math.floor((overtimeMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('overtimeHours').textContent = `${overtimeHours}h ${overtimeMinutes}m`;
                    document.getElementById('overtimeDiv').classList.remove('hidden');
                }
            } else { // Monday to Friday - regular schedule
                if (hour < 17) {
                    outStatus = 'Anda Pulang Sebelum Waktunya';
                    outClass = 'font-medium text-yellow-600';
                } else if (hour === 17 && minute <= 30) {
                    outStatus = 'Anda Pulang Tepat Waktu';
                    outClass = 'font-medium text-green-600';
                } else {
                    outStatus = 'Waktu Kerja Melebihi';
                    outClass = 'font-medium text-blue-600';
                    
                    // Calculate overtime for weekdays (after 17:31)
                    const overtimeStart = new Date(now);
                    overtimeStart.setHours(17, 31, 0, 0);
                    const overtimeMs = now.getTime() - overtimeStart.getTime();
                    const overtimeHours = Math.floor(overtimeMs / (1000 * 60 * 60));
                    const overtimeMinutes = Math.floor((overtimeMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('overtimeHours').textContent = `${overtimeHours}h ${overtimeMinutes}m`;
                    document.getElementById('overtimeDiv').classList.remove('hidden');
                }
            }
            
            document.getElementById('clockOutStatus').textContent = outStatus;
            document.getElementById('clockOutStatus').className = outClass;
            document.getElementById('clockOutStatusDiv').classList.remove('hidden');
            
            // Calculate total work time
            const workTimeMs = clockOutTime.getTime() - clockInTime.getTime();
            const workHours = Math.floor(workTimeMs / (1000 * 60 * 60));
            const workMinutes = Math.floor((workTimeMs % (1000 * 60 * 60)) / (1000 * 60));
            const workSeconds = Math.floor((workTimeMs % (1000 * 60)) / 1000);
            
            document.getElementById('totalWorktime').textContent = `${workHours}h ${workMinutes}m ${workSeconds}s`;
            document.getElementById('worktimeDiv').classList.remove('hidden');
        }

        // Add attendance record to history
        function addAttendanceRecord() {
            const tbody = document.getElementById('attendanceHistory');
            const noDataRow = document.getElementById('noDataRow');
            
            if (noDataRow) {
                noDataRow.remove();
            }
            
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-100 hover:bg-gray-50 cursor-pointer';
            row.id = 'currentAttendanceRow';
            
            const date = clockInTime.toLocaleDateString('id-ID');
            const timeIn = clockInTime.toLocaleTimeString('id-ID');
            const isLate = clockInTime.getHours() > 9 || (clockInTime.getHours() === 9 && clockInTime.getMinutes() > 0);
            const statusClass = isLate ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
            const statusText = isLate ? 'Terlambat' : 'Clock In';
            
            row.innerHTML = `
                <td class="py-3 px-4">${date}</td>
                <td class="py-3 px-4">${timeIn}</td>
                <td class="py-3 px-4">-</td>
                <td class="py-3 px-4"><span class="${statusClass} px-2 py-1 rounded-full text-sm">${statusText}</span></td>
            `;
            
            // Add click event to show detail
            row.addEventListener('click', function() {
                showAttendanceDetail(attendanceData);
            });
            
            tbody.insertBefore(row, tbody.firstChild);
            
            // Add to admin attendance database
            const attendanceRecord = {
                id: nextAttendanceId++,
                employeeName: currentUser.name,
                employeeEmail: currentUser.email,
                employeeDivision: currentUser.division,
                employeePosition: currentUser.position,
                date: clockInTime.toISOString().split('T')[0],
                clockIn: attendanceData.clockIn,
                clockOut: null,
                adminNotes: null,
                lastModified: new Date(),
                modifiedBy: null
            };
            
            attendanceDatabase.unshift(attendanceRecord);
            
            // Update stats
            updateStats();
            
            // Update admin stats if admin dashboard is visible
            if (!document.getElementById('adminDashboard').classList.contains('hidden')) {
                updateAdminStats();
            }
        }

        // Update last attendance record
        function updateLastAttendanceRecord() {
            const currentRow = document.getElementById('currentAttendanceRow');
            if (currentRow) {
                const cells = currentRow.getElementsByTagName('td');
                const timeOut = clockOutTime.toLocaleTimeString('id-ID');
                cells[2].textContent = timeOut;
                cells[3].innerHTML = '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">Hadir</span>';
            }
            
            // Update admin attendance database
            const currentRecord = attendanceDatabase.find(record => 
                record.employeeName === currentUser.name && 
                record.date === clockInTime.toISOString().split('T')[0] &&
                !record.clockOut
            );
            
            if (currentRecord) {
                currentRecord.clockOut = attendanceData.clockOut;
                currentRecord.lastModified = new Date();
            }
            
            // Update stats
            updateStats();
            
            // Update admin stats if admin dashboard is visible
            if (!document.getElementById('adminDashboard').classList.contains('hidden')) {
                updateAdminStats();
            }
        }

        // Update statistics
        function updateStats() {
            const tbody = document.getElementById('attendanceHistory');
            const rows = tbody.getElementsByTagName('tr');
            let attendance = 0;
            let late = 0;
            let totalHours = 0;
            
            for (let row of rows) {
                if (row.id === 'noDataRow') continue;
                
                const statusSpan = row.querySelector('span');
                if (statusSpan) {
                    const statusText = statusSpan.textContent;
                    if (statusText === 'Hadir') {
                        attendance++;
                        // Calculate work hours (simplified)
                        totalHours += 8;
                    } else if (statusText === 'Terlambat') {
                        attendance++;
                        late++;
                        totalHours += 8;
                    }
                }
            }
            
            document.getElementById('monthlyAttendance').textContent = attendance;
            document.getElementById('monthlyLate').textContent = late;
            document.getElementById('monthlyWorkHours').textContent = totalHours + 'h';
        }

        // Login function
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Check admin login
            if (email === 'admin@twa.com' && password === 'admintwa021') {
                currentUser = { name: 'Administrator', role: 'admin', email: email };
                showDashboard('admin');
                isLoggedIn = true;
                return;
            }
            
            // Check employee database
            let foundEmployee = null;
            for (const [name, data] of Object.entries(employeeDatabase)) {
                if (data.email === email && data.password === password) {
                    foundEmployee = { name: name, role: data.role, email: email, division: data.division, position: data.position };
                    break;
                }
            }
            
            if (foundEmployee) {
                currentUser = foundEmployee;
                showDashboard('user');
                isLoggedIn = true;
            } else {
                alert('Email atau password salah!');
            }
        });

        // Show dashboard
        function showDashboard(role) {
            document.getElementById('loginPage').classList.add('hidden');
            
            if (role === 'admin') {
                document.getElementById('adminDashboard').classList.remove('hidden');
                updateAdminStats();
            } else {
                document.getElementById('userDashboard').classList.remove('hidden');
                document.getElementById('userName').textContent = currentUser.name;
            }
        }

        // Update admin statistics with real data
        function updateAdminStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Total employees
            const totalEmployees = Object.keys(employeeDatabase).length;
            document.getElementById('totalEmployees').textContent = totalEmployees;
            
            // Today's attendance data
            const todayAttendance = attendanceDatabase.filter(record => record.date === today);
            
            // Present today (has clock in)
            const presentToday = todayAttendance.length;
            document.getElementById('presentToday').textContent = presentToday;
            
            // Late today (has clock in and is late)
            const lateToday = todayAttendance.filter(record => 
                record.clockIn && record.clockIn.isLate
            ).length;
            document.getElementById('lateToday').textContent = lateToday;
            
            // Absent today (total employees - present today)
            const absentToday = totalEmployees - presentToday;
            document.getElementById('absentToday').textContent = absentToday;
        }

        // Show tab function
        function showTab(tabName) {
            // Hide all tabs
            document.getElementById('historyTab').classList.add('hidden');
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-blue-500', 'text-blue-600');
        }

        // Profile functions
        function toggleProfileMenu() {
            const menu = document.getElementById('profileMenu');
            menu.classList.toggle('hidden');
        }

        function showProfileModal() {
            document.getElementById('profileMenu').classList.add('hidden');
            document.getElementById('profileModal').classList.remove('hidden');
            
            // Load current user data
            if (currentUser) {
                document.getElementById('profileName').value = currentUser.name || '';
                document.getElementById('profileEmail').value = currentUser.email || '';
                document.getElementById('profilePhone').value = currentUser.phone || '';
                document.getElementById('profileDepartment').value = currentUser.department || '';
                
                if (currentUser.profilePhoto) {
                    document.getElementById('profilePhotoPreview').src = currentUser.profilePhoto;
                }
            }
        }

        function hideProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
        }

        function previewProfilePhoto(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar. Maksimal 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('profilePhotoPreview');
                    const headerPhoto = document.getElementById('userProfilePhoto');
                    
                    preview.src = e.target.result;
                    headerPhoto.src = e.target.result;
                    
                    // Store in currentUser
                    if (currentUser) {
                        currentUser.profilePhoto = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Profile form handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (currentUser) {
                    currentUser.name = document.getElementById('profileName').value;
                    currentUser.phone = document.getElementById('profilePhone').value;
                    currentUser.department = document.getElementById('profileDepartment').value;
                    
                    // Update display name
                    document.getElementById('userName').textContent = currentUser.name;
                    
                    hideProfileModal();
                    alert('Profile berhasil diupdate!');
                }
            });
            
            // Close profile menu when clicking outside
            document.addEventListener('click', function(event) {
                const profileMenu = document.getElementById('profileMenu');
                const profileButton = event.target.closest('button[onclick="toggleProfileMenu()"]');
                
                if (!profileButton && !profileMenu.contains(event.target)) {
                    profileMenu.classList.add('hidden');
                }
            });
        });

        // News Management Functions
        function loadNews() {
            loadNewsPreview();
            loadNewsTable();
            loadEmployeeTable();
        }

        function loadNewsPreview() {
            const container = document.getElementById('newsPreviewContainer');
            const activeNews = newsDatabase.filter(news => news.isActive).slice(0, 2);
            
            container.innerHTML = activeNews.map(news => {
                const categoryIcons = {
                    'HR': 'fas fa-gift text-green-600',
                    'Training': 'fas fa-graduation-cap text-purple-600',
                    'Announcement': 'fas fa-bullhorn text-blue-600',
                    'Event': 'fas fa-calendar text-orange-600',
                    'Policy': 'fas fa-file-alt text-gray-600',
                    'Safety': 'fas fa-shield-alt text-red-600'
                };
                
                const categoryColors = {
                    'HR': 'bg-green-100',
                    'Training': 'bg-purple-100',
                    'Announcement': 'bg-blue-100',
                    'Event': 'bg-orange-100',
                    'Policy': 'bg-gray-100',
                    'Safety': 'bg-red-100'
                };
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200 cursor-pointer" onclick="showNewsDetail(${news.id})">
                        <div class="flex items-start">
                            <div class="${categoryColors[news.category] || 'bg-gray-100'} p-2 rounded-lg mr-3 flex-shrink-0">
                                <i class="${categoryIcons[news.category] || 'fas fa-newspaper text-gray-600'}"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-800 mb-1">${news.title}</h3>
                                <p class="text-sm text-gray-600 mb-2">${news.summary}</p>
                                <span class="text-xs text-blue-600 font-medium">${new Date(news.date).toLocaleDateString('id-ID')}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateNewsTicker() {
            const ticker = document.getElementById('newsTickerContent');
            const activeNews = newsDatabase.filter(news => news.isActive && news.isNotified);
            
            const tickerContent = activeNews.map(news => {
                const emojis = {
                    'HR': '🎉',
                    'Training': '📚',
                    'Announcement': '📢',
                    'Event': '🎊',
                    'Policy': '📋',
                    'Safety': '⚠️'
                };
                
                return `${emojis[news.category] || '📰'} ${news.title}`;
            }).join(' • ');
            
            ticker.textContent = tickerContent || '📰 Tidak ada berita terbaru saat ini';
        }

        function loadNewsTable() {
            const tbody = document.getElementById('newsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = newsDatabase.map(news => `
                <tr class="border-b border-gray-100">
                    <td class="py-3 px-4">
                        <div class="font-medium text-gray-800">${news.title}</div>
                        <div class="text-sm text-gray-500">${news.summary.substring(0, 60)}...</div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${news.category}</span>
                    </td>
                    <td class="py-3 px-4 text-sm text-gray-600">${new Date(news.date).toLocaleDateString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${news.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${news.isActive ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${news.isNotified ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                            ${news.isNotified ? 'Ya' : 'Tidak'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="editNews(${news.id})" class="text-blue-600 hover:text-blue-800" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="toggleNewsStatus(${news.id})" class="text-yellow-600 hover:text-yellow-800" title="Toggle Status">
                                <i class="fas fa-toggle-${news.isActive ? 'on' : 'off'}"></i>
                            </button>
                            <button onclick="toggleNewsNotification(${news.id})" class="text-purple-600 hover:text-purple-800" title="Toggle Notifikasi">
                                <i class="fas fa-bell${news.isNotified ? '' : '-slash'}"></i>
                            </button>
                            <button onclick="deleteNews(${news.id})" class="text-red-600 hover:text-red-800" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function loadEmployeeTable() {
            const tbody = document.getElementById('employeeTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = Object.entries(employeeDatabase).map(([name, data]) => `
                <tr class="border-b border-gray-100">
                    <td class="py-3 px-4 font-medium text-gray-800">${name}</td>
                    <td class="py-3 px-4 text-gray-600">${data.email}</td>
                    <td class="py-3 px-4 text-gray-600">${data.division}</td>
                    <td class="py-3 px-4 text-gray-600">${data.position}</td>
                    <td class="py-3 px-4">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">Aktif</span>
                    </td>
                </tr>
            `).join('');
        }

        function searchEmployees() {
            const searchTerm = document.getElementById('employeeSearch').value.toLowerCase();
            const tbody = document.getElementById('employeeTableBody');
            
            const filteredEmployees = Object.entries(employeeDatabase).filter(([name, data]) => 
                name.toLowerCase().includes(searchTerm) || 
                data.email.toLowerCase().includes(searchTerm) ||
                data.division.toLowerCase().includes(searchTerm) ||
                data.position.toLowerCase().includes(searchTerm)
            );
            
            tbody.innerHTML = filteredEmployees.map(([name, data]) => `
                <tr class="border-b border-gray-100">
                    <td class="py-3 px-4 font-medium text-gray-800">${name}</td>
                    <td class="py-3 px-4 text-gray-600">${data.email}</td>
                    <td class="py-3 px-4 text-gray-600">${data.division}</td>
                    <td class="py-3 px-4 text-gray-600">${data.position}</td>
                    <td class="py-3 px-4">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">Aktif</span>
                    </td>
                </tr>
            `).join('');
        }

        function showNewsDetail(newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (!news) return;
            
            const modal = document.getElementById('newsDetailModal');
            const title = document.getElementById('newsDetailTitle');
            const content = document.getElementById('newsDetailContent');
            
            title.textContent = news.title;
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">${news.category}</span>
                            <span class="text-sm text-gray-600">${new Date(news.date).toLocaleDateString('id-ID')}</span>
                            <span class="text-sm text-gray-600">oleh ${news.author}</span>
                        </div>
                    </div>
                    
                    ${news.image ? `
                    <div class="text-center">
                        <img src="${news.image}" alt="${news.title}" class="w-full max-w-2xl mx-auto rounded-lg shadow-md">
                    </div>
                    ` : ''}
                    
                    <div class="prose max-w-none">
                        <div class="text-lg text-gray-800 leading-relaxed whitespace-pre-line">${news.content}</div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function hideNewsDetail() {
            document.getElementById('newsDetailModal').classList.add('hidden');
        }

        function showAddNewsModal() {
            document.getElementById('newsModalTitle').textContent = 'Tambah Berita';
            document.getElementById('newsForm').reset();
            document.getElementById('newsId').value = '';
            document.getElementById('newsImagePreview').classList.add('hidden');
            document.getElementById('newsModal').classList.remove('hidden');
        }

        function editNews(newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (!news) return;
            
            document.getElementById('newsModalTitle').textContent = 'Edit Berita';
            document.getElementById('newsId').value = news.id;
            document.getElementById('newsTitle').value = news.title;
            document.getElementById('newsCategory').value = news.category;
            document.getElementById('newsSummary').value = news.summary;
            document.getElementById('newsContent').value = news.content;
            document.getElementById('newsAuthor').value = news.author;
            document.getElementById('newsActive').checked = news.isActive;
            document.getElementById('newsNotify').checked = news.isNotified;
            
            if (news.image) {
                document.getElementById('newsImagePreview').src = news.image;
                document.getElementById('newsImagePreview').classList.remove('hidden');
            }
            
            document.getElementById('newsModal').classList.remove('hidden');
        }

        function hideNewsModal() {
            document.getElementById('newsModal').classList.add('hidden');
        }

        function previewNewsImage(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar. Maksimal 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('newsImagePreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function toggleNewsStatus(newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (news) {
                news.isActive = !news.isActive;
                loadNews();
                updateNewsTicker();
            }
        }

        function toggleNewsNotification(newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (news) {
                news.isNotified = !news.isNotified;
                loadNews();
                updateNewsTicker();
            }
        }

        function deleteNews(newsId) {
            if (confirm('Apakah Anda yakin ingin menghapus berita ini?')) {
                const index = newsDatabase.findIndex(n => n.id === newsId);
                if (index > -1) {
                    newsDatabase.splice(index, 1);
                    loadNews();
                    updateNewsTicker();
                }
            }
        }

        // News form handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('newsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newsId = document.getElementById('newsId').value;
                const newsData = {
                    title: document.getElementById('newsTitle').value,
                    category: document.getElementById('newsCategory').value,
                    summary: document.getElementById('newsSummary').value,
                    content: document.getElementById('newsContent').value,
                    author: document.getElementById('newsAuthor').value || 'Admin',
                    isActive: document.getElementById('newsActive').checked,
                    isNotified: document.getElementById('newsNotify').checked,
                    image: document.getElementById('newsImagePreview').src || null
                };
                
                if (newsId) {
                    // Edit existing news
                    const news = newsDatabase.find(n => n.id == newsId);
                    if (news) {
                        Object.assign(news, newsData);
                    }
                } else {
                    // Add new news
                    newsData.id = nextNewsId++;
                    newsData.date = new Date().toISOString().split('T')[0];
                    newsDatabase.unshift(newsData);
                }
                
                loadNews();
                updateNewsTicker();
                hideNewsModal();
                alert(newsId ? 'Berita berhasil diupdate!' : 'Berita berhasil ditambahkan!');
            });
        });

        // Show admin tab function
        function showAdminTab(tabName) {
            // Hide all admin tabs
            document.getElementById('newsTab').classList.add('hidden');
            document.getElementById('employeesTab').classList.add('hidden');
            document.getElementById('attendanceTab').classList.add('hidden');
            document.getElementById('brandingTab').classList.add('hidden');
            document.getElementById('reportsTab').classList.add('hidden');
            document.getElementById('settingsTab').classList.add('hidden');
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Load data for specific tabs
            if (tabName === 'attendance') {
                loadAttendanceHistory();
                setDefaultDateFilter();
            }
            
            // Update stats when switching tabs
            updateAdminStats();
            
            // Update tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-purple-500', 'text-purple-600');
        }

        // Attendance Management Functions
        function setDefaultDateFilter() {
            const today = new Date();
            const dateFilter = document.getElementById('attendanceDateFilter');
            if (dateFilter) {
                dateFilter.value = today.toISOString().split('T')[0];
            }
        }

        function loadAttendanceHistory() {
            const tbody = document.getElementById('attendanceHistoryTableBody');
            if (!tbody) return;
            
            // Clear existing data
            tbody.innerHTML = '';
            
            if (attendanceDatabase.length === 0) {
                tbody.innerHTML = `
                    <tr id="noAttendanceDataRow">
                        <td colspan="7" class="py-8 px-4 text-center text-gray-500">
                            <i class="fas fa-calendar-times text-4xl mb-2"></i>
                            <p>Belum ada data absensi</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by date (newest first)
            const sortedData = [...attendanceDatabase].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach(record => {
                const row = createAttendanceRow(record);
                tbody.appendChild(row);
            });
            
            // Update filter summary
            updateFilterSummary(attendanceDatabase.length, attendanceDatabase.length);
        }

        function createAttendanceRow(record) {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-100 hover:bg-gray-50 cursor-pointer';
            
            const clockInTime = record.clockIn ? record.clockIn.time.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }) : '-';
            const clockOutTime = record.clockOut ? record.clockOut.time.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }) : '-';
            
            // Determine status
            let status = '';
            let statusClass = '';
            
            if (!record.clockOut) {
                status = 'Clock In';
                statusClass = 'bg-blue-100 text-blue-800';
            } else if (record.clockIn.isLate) {
                status = 'Terlambat';
                statusClass = 'bg-yellow-100 text-yellow-800';
            } else {
                status = 'Hadir';
                statusClass = 'bg-green-100 text-green-800';
            }
            
            // Location status
            const locationStatus = (record.clockIn.withinRadius && (!record.clockOut || record.clockOut.withinRadius)) ? 
                'Dalam Radius' : 'Ada di Luar Radius';
            const locationClass = (record.clockIn.withinRadius && (!record.clockOut || record.clockOut.withinRadius)) ? 
                'text-green-600' : 'text-yellow-600';
            
            row.innerHTML = `
                <td class="py-3 px-4">
                    <div class="font-medium text-gray-800">${record.employeeName}</div>
                    <div class="text-sm text-gray-500">${record.employeePosition}</div>
                </td>
                <td class="py-3 px-4">${new Date(record.date).toLocaleDateString('id-ID')}</td>
                <td class="py-3 px-4">${clockInTime}</td>
                <td class="py-3 px-4">${clockOutTime}</td>
                <td class="py-3 px-4">
                    <span class="${statusClass} px-2 py-1 rounded-full text-sm">${status}</span>
                </td>
                <td class="py-3 px-4">
                    <span class="text-sm ${locationClass}">${locationStatus}</span>
                </td>
                <td class="py-3 px-4">
                    <div class="flex space-x-2">
                        <button onclick="viewAttendanceDetail(${record.id})" class="text-blue-600 hover:text-blue-800" title="Lihat Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="editAttendanceRecord(${record.id})" class="text-purple-600 hover:text-purple-800" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteAttendanceRecord(${record.id})" class="text-red-600 hover:text-red-800" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            
            return row;
        }

        function applyAttendanceFilter() {
            const nameFilter = document.getElementById('attendanceNameFilter').value.toLowerCase();
            const periodFilter = document.getElementById('attendancePeriodFilter').value;
            const dateFilter = document.getElementById('attendanceDateFilter').value;
            
            if (!dateFilter) {
                alert('Silakan pilih tanggal untuk filter!');
                return;
            }
            
            const filterDate = new Date(dateFilter);
            let filteredData = [...attendanceDatabase];
            
            // Filter by name
            if (nameFilter) {
                filteredData = filteredData.filter(record => 
                    record.employeeName.toLowerCase().includes(nameFilter) ||
                    record.employeeEmail.toLowerCase().includes(nameFilter) ||
                    record.employeePosition.toLowerCase().includes(nameFilter)
                );
            }
            
            // Filter by period
            filteredData = filteredData.filter(record => {
                const recordDate = new Date(record.date);
                
                switch (periodFilter) {
                    case 'daily':
                        return recordDate.toDateString() === filterDate.toDateString();
                    
                    case 'weekly':
                        const weekStart = new Date(filterDate);
                        weekStart.setDate(filterDate.getDate() - filterDate.getDay());
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekStart.getDate() + 6);
                        return recordDate >= weekStart && recordDate <= weekEnd;
                    
                    case 'monthly':
                        return recordDate.getMonth() === filterDate.getMonth() && 
                               recordDate.getFullYear() === filterDate.getFullYear();
                    
                    default:
                        return true;
                }
            });
            
            // Update table
            const tbody = document.getElementById('attendanceHistoryTableBody');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 px-4 text-center text-gray-500">
                            <i class="fas fa-search text-4xl mb-2"></i>
                            <p>Tidak ada data yang sesuai dengan filter</p>
                        </td>
                    </tr>
                `;
            } else {
                // Sort by date (newest first)
                const sortedData = filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedData.forEach(record => {
                    const row = createAttendanceRow(record);
                    tbody.appendChild(row);
                });
            }
            
            // Update filter summary
            updateFilterSummary(filteredData.length, attendanceDatabase.length);
        }

        function resetAttendanceFilter() {
            document.getElementById('attendanceNameFilter').value = '';
            document.getElementById('attendancePeriodFilter').value = 'daily';
            setDefaultDateFilter();
            
            // Hide filter summary
            document.getElementById('attendanceFilterSummary').classList.add('hidden');
            
            // Reload all data
            loadAttendanceHistory();
        }

        function updateFilterSummary(filteredCount, totalCount) {
            const summary = document.getElementById('attendanceFilterSummary');
            const summaryText = document.getElementById('filterSummaryText');
            const resultCount = document.getElementById('filterResultCount');
            
            if (filteredCount < totalCount) {
                const nameFilter = document.getElementById('attendanceNameFilter').value;
                const periodFilter = document.getElementById('attendancePeriodFilter').value;
                const dateFilter = document.getElementById('attendanceDateFilter').value;
                
                let filterText = `Filter aktif: ${periodFilter === 'daily' ? 'Harian' : periodFilter === 'weekly' ? 'Mingguan' : 'Bulanan'}`;
                if (dateFilter) filterText += ` (${new Date(dateFilter).toLocaleDateString('id-ID')})`;
                if (nameFilter) filterText += `, Nama: "${nameFilter}"`;
                
                summaryText.textContent = filterText;
                resultCount.textContent = `${filteredCount} dari ${totalCount} record`;
                summary.classList.remove('hidden');
            } else {
                summary.classList.add('hidden');
            }
        }

        function viewAttendanceDetail(attendanceId) {
            const record = attendanceDatabase.find(r => r.id === attendanceId);
            if (!record) return;
            
            // Convert to format expected by showAttendanceDetail
            const attendanceData = {
                clockIn: record.clockIn,
                clockOut: record.clockOut
            };
            
            showAttendanceDetail(attendanceData);
        }

        function editAttendanceRecord(attendanceId) {
            const record = attendanceDatabase.find(r => r.id === attendanceId);
            if (!record) return;
            
            // Populate edit form
            document.getElementById('editAttendanceId').value = record.id;
            document.getElementById('editEmployeeName').value = record.employeeName;
            document.getElementById('editEmployeeEmail').value = record.employeeEmail;
            document.getElementById('editEmployeeDivision').value = record.employeeDivision;
            document.getElementById('editEmployeePosition').value = record.employeePosition;
            
            // Clock In data
            if (record.clockIn) {
                const clockInTime = new Date(record.clockIn.time);
                document.getElementById('editClockInTime').value = clockInTime.toISOString().slice(0, 16);
                document.getElementById('editDutyAs').value = record.clockIn.dutyAs || '';
                document.getElementById('editWorkType').value = record.clockIn.workType || '';
                document.getElementById('editLocationIn').value = `${record.clockIn.location.lat}, ${record.clockIn.location.lng}`;
                document.getElementById('editRadiusStatusIn').value = record.clockIn.withinRadius.toString();
                document.getElementById('editOutsideReasonIn').value = record.clockIn.outsideReason || '';
                document.getElementById('editLateStatus').value = record.clockIn.isLate.toString();
                document.getElementById('editLateReason').value = record.clockIn.lateReason || '';
                document.getElementById('editPhotoIn').src = record.clockIn.photo || '';
            }
            
            // Clock Out data
            if (record.clockOut) {
                const clockOutTime = new Date(record.clockOut.time);
                document.getElementById('editClockOutTime').value = clockOutTime.toISOString().slice(0, 16);
                document.getElementById('editLocationOut').value = `${record.clockOut.location.lat}, ${record.clockOut.location.lng}`;
                document.getElementById('editRadiusStatusOut').value = record.clockOut.withinRadius.toString();
                document.getElementById('editOutsideReasonOut').value = record.clockOut.outsideReason || '';
                document.getElementById('editWorkReport').value = record.clockOut.workReport || '';
                
                if (record.clockOut.workPhoto) {
                    document.getElementById('editPhotoOut').src = record.clockOut.workPhoto;
                    document.getElementById('editPhotoOut').classList.remove('hidden');
                    document.getElementById('editNoPhotoOut').classList.add('hidden');
                } else {
                    document.getElementById('editPhotoOut').classList.add('hidden');
                    document.getElementById('editNoPhotoOut').classList.remove('hidden');
                }
                
                document.getElementById('editClockOutSection').classList.remove('hidden');
            } else {
                document.getElementById('editClockOutSection').classList.add('hidden');
            }
            
            // Admin notes
            document.getElementById('editAdminNotes').value = record.adminNotes || '';
            
            // Show modal
            document.getElementById('adminAttendanceEditModal').classList.remove('hidden');
            
            // Setup conditional field visibility
            setupEditFormConditionals();
        }

        function setupEditFormConditionals() {
            // Handle radius status changes
            document.getElementById('editRadiusStatusIn').addEventListener('change', function() {
                const outsideReasonDiv = document.getElementById('editOutsideReasonInDiv');
                if (this.value === 'false') {
                    outsideReasonDiv.classList.remove('hidden');
                } else {
                    outsideReasonDiv.classList.add('hidden');
                    document.getElementById('editOutsideReasonIn').value = '';
                }
            });
            
            document.getElementById('editRadiusStatusOut').addEventListener('change', function() {
                const outsideReasonDiv = document.getElementById('editOutsideReasonOutDiv');
                if (this.value === 'false') {
                    outsideReasonDiv.classList.remove('hidden');
                } else {
                    outsideReasonDiv.classList.add('hidden');
                    document.getElementById('editOutsideReasonOut').value = '';
                }
            });
            
            // Handle late status changes
            document.getElementById('editLateStatus').addEventListener('change', function() {
                const lateReasonDiv = document.getElementById('editLateReasonDiv');
                if (this.value === 'true') {
                    lateReasonDiv.classList.remove('hidden');
                } else {
                    lateReasonDiv.classList.add('hidden');
                    document.getElementById('editLateReason').value = '';
                }
            });
            
            // Trigger initial state
            document.getElementById('editRadiusStatusIn').dispatchEvent(new Event('change'));
            document.getElementById('editRadiusStatusOut').dispatchEvent(new Event('change'));
            document.getElementById('editLateStatus').dispatchEvent(new Event('change'));
        }

        function hideAdminAttendanceEdit() {
            document.getElementById('adminAttendanceEditModal').classList.add('hidden');
        }

        function deleteAttendanceRecord(attendanceId) {
            const record = attendanceDatabase.find(r => r.id === attendanceId);
            if (!record) return;
            
            if (confirm(`Apakah Anda yakin ingin menghapus data absensi ${record.employeeName} pada ${new Date(record.date).toLocaleDateString('id-ID')}?`)) {
                const index = attendanceDatabase.findIndex(r => r.id === attendanceId);
                if (index > -1) {
                    attendanceDatabase.splice(index, 1);
                    loadAttendanceHistory();
                    updateAdminStats();
                    alert('Data absensi berhasil dihapus!');
                }
            }
        }

        // Admin attendance edit form handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminAttendanceEditForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const attendanceId = parseInt(document.getElementById('editAttendanceId').value);
                const record = attendanceDatabase.find(r => r.id === attendanceId);
                
                if (!record) {
                    alert('Data tidak ditemukan!');
                    return;
                }
                
                try {
                    // Update clock in data
                    const clockInTime = new Date(document.getElementById('editClockInTime').value);
                    const locationInParts = document.getElementById('editLocationIn').value.split(',');
                    
                    record.clockIn.time = clockInTime;
                    record.clockIn.dutyAs = document.getElementById('editDutyAs').value;
                    record.clockIn.workType = document.getElementById('editWorkType').value;
                    record.clockIn.location = {
                        lat: parseFloat(locationInParts[0].trim()),
                        lng: parseFloat(locationInParts[1].trim())
                    };
                    record.clockIn.withinRadius = document.getElementById('editRadiusStatusIn').value === 'true';
                    record.clockIn.outsideReason = document.getElementById('editOutsideReasonIn').value || null;
                    record.clockIn.isLate = document.getElementById('editLateStatus').value === 'true';
                    record.clockIn.lateReason = document.getElementById('editLateReason').value || null;
                    
                    // Update clock out data if exists
                    const clockOutTime = document.getElementById('editClockOutTime').value;
                    if (clockOutTime && record.clockOut) {
                        const locationOutParts = document.getElementById('editLocationOut').value.split(',');
                        
                        record.clockOut.time = new Date(clockOutTime);
                        record.clockOut.location = {
                            lat: parseFloat(locationOutParts[0].trim()),
                            lng: parseFloat(locationOutParts[1].trim())
                        };
                        record.clockOut.withinRadius = document.getElementById('editRadiusStatusOut').value === 'true';
                        record.clockOut.outsideReason = document.getElementById('editOutsideReasonOut').value || null;
                        record.clockOut.workReport = document.getElementById('editWorkReport').value;
                    }
                    
                    // Update admin notes and metadata
                    record.adminNotes = document.getElementById('editAdminNotes').value || null;
                    record.lastModified = new Date();
                    record.modifiedBy = currentUser ? currentUser.name : 'Admin';
                    
                    // Reload table
                    loadAttendanceHistory();
                    updateAdminStats();
                    hideAdminAttendanceEdit();
                    
                    alert('Data absensi berhasil diupdate!');
                    
                } catch (error) {
                    alert('Terjadi kesalahan saat menyimpan data. Periksa format input Anda.');
                    console.error('Error updating attendance:', error);
                }
            });
        });

        // Show attendance detail
        function showAttendanceDetail(data) {
            const modal = document.getElementById('attendanceDetailModal');
            const content = document.getElementById('attendanceDetailContent');
            
            let detailHTML = '';
            
            // Clock In Card
            if (data.clockIn) {
                const clockInData = data.clockIn;
                detailHTML += `
                    <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-green-500 p-3 rounded-lg mr-4">
                                <i class="fas fa-clock text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-green-800">Clock In</h3>
                                <p class="text-green-600">${clockInData.time.toLocaleDateString('id-ID')} - ${clockInData.time.toLocaleTimeString('id-ID')}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Personal Info -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.name}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.email}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Divisi</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.division}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Posisi</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.position}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bertugas Sebagai</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.dutyAs}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Pekerjaan</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.workType}</p>
                                </div>
                            </div>
                            
                            <!-- Location & Status Info -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Lokasi</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border font-mono text-sm">${clockInData.location.lat.toFixed(6)}, ${clockInData.location.lng.toFixed(6)}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Status Radius</label>
                                    <p class="p-3 rounded-lg border ${clockInData.withinRadius ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${clockInData.withinRadius ? 'Dalam Radius Kantor' : 'Di Luar Radius Kantor'}
                                    </p>
                                </div>
                                ${!clockInData.withinRadius ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Alasan di Luar Radius</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.outsideReason}</p>
                                </div>
                                ` : ''}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Status Keterlambatan</label>
                                    <p class="p-3 rounded-lg border ${clockInData.isLate ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                                        ${clockInData.isLate ? 'Terlambat' : 'Tepat Waktu'}
                                    </p>
                                </div>
                                ${clockInData.isLate ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Alasan Terlambat</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockInData.lateReason}</p>
                                </div>
                                ` : ''}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Foto Masuk</label>
                                    <div class="bg-white p-3 rounded-lg border">
                                        <img src="${clockInData.photo}" alt="Foto Masuk" class="w-full max-w-xs rounded-lg">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Clock Out Card
            if (data.clockOut) {
                const clockOutData = data.clockOut;
                detailHTML += `
                    <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-red-500 p-3 rounded-lg mr-4">
                                <i class="fas fa-clock text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-red-800">Clock Out</h3>
                                <p class="text-red-600">${clockOutData.time.toLocaleDateString('id-ID')} - ${clockOutData.time.toLocaleTimeString('id-ID')}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Location Info -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Lokasi Pulang</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border font-mono text-sm">${clockOutData.location.lat.toFixed(6)}, ${clockOutData.location.lng.toFixed(6)}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Status Radius</label>
                                    <p class="p-3 rounded-lg border ${clockOutData.withinRadius ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${clockOutData.withinRadius ? 'Dalam Radius Kantor' : 'Di Luar Radius Kantor'}
                                    </p>
                                </div>
                                ${!clockOutData.withinRadius ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Alasan di Luar Radius</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockOutData.outsideReason}</p>
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- Work Report -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Laporan Pekerjaan</label>
                                    <p class="text-gray-900 bg-white p-3 rounded-lg border">${clockOutData.workReport}</p>
                                </div>
                                ${clockOutData.workPhoto ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Foto Pekerjaan</label>
                                    <div class="bg-white p-3 rounded-lg border">
                                        <img src="${clockOutData.workPhoto}" alt="Foto Pekerjaan" class="w-full max-w-xs rounded-lg">
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Work Summary Card
            if (data.clockIn && data.clockOut) {
                const workTimeMs = data.clockOut.time.getTime() - data.clockIn.time.getTime();
                const workHours = Math.floor(workTimeMs / (1000 * 60 * 60));
                const workMinutes = Math.floor((workTimeMs % (1000 * 60 * 60)) / (1000 * 60));
                const workSeconds = Math.floor((workTimeMs % (1000 * 60)) / 1000);
                
                detailHTML += `
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-blue-500 p-3 rounded-lg mr-4">
                                <i class="fas fa-chart-line text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-blue-800">Ringkasan Kerja</h3>
                                <p class="text-blue-600">Total waktu kerja hari ini</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white p-4 rounded-lg border text-center">
                                <p class="text-sm text-gray-600 mb-1">Total Waktu Kerja</p>
                                <p class="text-2xl font-bold text-blue-600">${workHours}h ${workMinutes}m ${workSeconds}s</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg border text-center">
                                <p class="text-sm text-gray-600 mb-1">Status Masuk</p>
                                <p class="text-lg font-semibold ${data.clockIn.isLate ? 'text-yellow-600' : 'text-green-600'}">
                                    ${data.clockIn.isLate ? 'Terlambat' : 'Tepat Waktu'}
                                </p>
                            </div>
                            <div class="bg-white p-4 rounded-lg border text-center">
                                <p class="text-sm text-gray-600 mb-1">Lokasi</p>
                                <p class="text-lg font-semibold ${data.clockIn.withinRadius && data.clockOut.withinRadius ? 'text-green-600' : 'text-yellow-600'}">
                                    ${data.clockIn.withinRadius && data.clockOut.withinRadius ? 'Dalam Radius' : 'Ada di Luar Radius'}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = detailHTML;
            modal.classList.remove('hidden');
        }

        // Hide attendance detail
        function hideAttendanceDetail() {
            document.getElementById('attendanceDetailModal').classList.add('hidden');
        }

        // Branding Management Functions
        function loadBrandingSettings() {
            // Load current settings into form
            document.getElementById('appTitle').value = appSettings.title;
            document.getElementById('appSubtitle').value = appSettings.subtitle;
            
            // Update login page
            updateLoginBranding();
            
            // Update preview
            updateBrandingPreview();
        }

        function updateLoginBranding() {
            const loginTitle = document.getElementById('loginTitle');
            const loginSubtitle = document.getElementById('loginSubtitle');
            const loginLogoImg = document.getElementById('loginLogoImg');
            const loginLogoIcon = document.getElementById('loginLogoIcon');
            
            if (loginTitle) loginTitle.textContent = appSettings.title;
            if (loginSubtitle) loginSubtitle.textContent = appSettings.subtitle;
            
            if (appSettings.logo && appSettings.logo !== 'default') {
                if (loginLogoImg) {
                    loginLogoImg.src = appSettings.logo;
                    loginLogoImg.classList.remove('hidden');
                }
                if (loginLogoIcon) loginLogoIcon.classList.add('hidden');
            } else {
                if (loginLogoImg) loginLogoImg.classList.add('hidden');
                if (loginLogoIcon) loginLogoIcon.classList.remove('hidden');
            }
        }

        function updateBrandingPreview() {
            const previewTitle = document.getElementById('previewTitle');
            const previewSubtitle = document.getElementById('previewSubtitle');
            const previewLogoImg = document.getElementById('previewLogoImg');
            const previewLogoIcon = document.getElementById('previewLogoIcon');
            const currentLogoImg = document.getElementById('currentLogoImg');
            const currentLogoIcon = document.getElementById('currentLogoIcon');
            
            // Update preview
            if (previewTitle) previewTitle.textContent = appSettings.title;
            if (previewSubtitle) previewSubtitle.textContent = appSettings.subtitle;
            
            // Update current logo display
            if (appSettings.logo && appSettings.logo !== 'default') {
                if (previewLogoImg) {
                    previewLogoImg.src = appSettings.logo;
                    previewLogoImg.classList.remove('hidden');
                }
                if (previewLogoIcon) previewLogoIcon.classList.add('hidden');
                
                if (currentLogoImg) {
                    currentLogoImg.src = appSettings.logo;
                    currentLogoImg.classList.remove('hidden');
                }
                if (currentLogoIcon) currentLogoIcon.classList.add('hidden');
            } else {
                if (previewLogoImg) previewLogoImg.classList.add('hidden');
                if (previewLogoIcon) previewLogoIcon.classList.remove('hidden');
                
                if (currentLogoImg) currentLogoImg.classList.add('hidden');
                if (currentLogoIcon) currentLogoIcon.classList.remove('hidden');
            }
        }

        function previewLogo(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar. Maksimal 2MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logoPreview');
                    const previewLogoImg = document.getElementById('previewLogoImg');
                    const previewLogoIcon = document.getElementById('previewLogoIcon');
                    
                    if (preview) {
                        preview.src = e.target.result;
                        preview.classList.remove('hidden');
                    }
                    
                    // Update preview in real-time
                    if (previewLogoImg) {
                        previewLogoImg.src = e.target.result;
                        previewLogoImg.classList.remove('hidden');
                    }
                    if (previewLogoIcon) previewLogoIcon.classList.add('hidden');
                    
                    // Store temporarily
                    appSettings.tempLogo = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveBranding() {
            // Get form values
            const title = document.getElementById('appTitle').value.trim();
            const subtitle = document.getElementById('appSubtitle').value.trim();
            
            if (!title) {
                alert('Judul aplikasi tidak boleh kosong!');
                return;
            }
            
            // Update settings
            appSettings.title = title;
            appSettings.subtitle = subtitle;
            
            if (appSettings.tempLogo) {
                appSettings.logo = appSettings.tempLogo;
                delete appSettings.tempLogo;
            }
            
            // Update all displays
            updateLoginBranding();
            updateBrandingPreview();
            
            // Update form values to reflect changes
            document.getElementById('appTitle').value = appSettings.title;
            document.getElementById('appSubtitle').value = appSettings.subtitle;
            
            alert('Pengaturan branding berhasil disimpan!');
        }

        function resetBranding() {
            if (confirm('Apakah Anda yakin ingin mereset ke pengaturan default?')) {
                // Reset to default
                appSettings.logo = 'default';
                appSettings.title = 'ECrew Absensi';
                appSettings.subtitle = 'Transwisata Employee System';
                
                // Clear temp logo
                delete appSettings.tempLogo;
                
                // Reset form
                document.getElementById('appTitle').value = appSettings.title;
                document.getElementById('appSubtitle').value = appSettings.subtitle;
                document.getElementById('logoUpload').value = '';
                document.getElementById('logoPreview').classList.add('hidden');
                
                // Update displays
                updateLoginBranding();
                updateBrandingPreview();
                
                alert('Pengaturan branding berhasil direset ke default!');
            }
        }

        // Real-time preview updates
        document.addEventListener('DOMContentLoaded', function() {
            const titleInput = document.getElementById('appTitle');
            const subtitleInput = document.getElementById('appSubtitle');
            
            if (titleInput) {
                titleInput.addEventListener('input', function() {
                    const previewTitle = document.getElementById('previewTitle');
                    if (previewTitle) previewTitle.textContent = this.value || 'ECrew Absensi';
                });
            }
            
            if (subtitleInput) {
                subtitleInput.addEventListener('input', function() {
                    const previewSubtitle = document.getElementById('previewSubtitle');
                    if (previewSubtitle) previewSubtitle.textContent = this.value || 'Transwisata Employee System';
                });
            }
        });

        // PDF Download Functions
        function downloadAttendancePDF() {
            // Get current filter values
            const nameFilter = document.getElementById('attendanceNameFilter').value.toLowerCase();
            const periodFilter = document.getElementById('attendancePeriodFilter').value;
            const dateFilter = document.getElementById('attendanceDateFilter').value;
            
            if (!dateFilter) {
                alert('Silakan pilih tanggal untuk filter sebelum download PDF!');
                return;
            }
            
            // Apply the same filter logic as in applyAttendanceFilter
            const filterDate = new Date(dateFilter);
            let filteredData = [...attendanceDatabase];
            
            // Filter by name
            if (nameFilter) {
                filteredData = filteredData.filter(record => 
                    record.employeeName.toLowerCase().includes(nameFilter) ||
                    record.employeeEmail.toLowerCase().includes(nameFilter) ||
                    record.employeePosition.toLowerCase().includes(nameFilter)
                );
            }
            
            // Filter by period
            filteredData = filteredData.filter(record => {
                const recordDate = new Date(record.date);
                
                switch (periodFilter) {
                    case 'daily':
                        return recordDate.toDateString() === filterDate.toDateString();
                    
                    case 'weekly':
                        const weekStart = new Date(filterDate);
                        weekStart.setDate(filterDate.getDate() - filterDate.getDay());
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekStart.getDate() + 6);
                        return recordDate >= weekStart && recordDate <= weekEnd;
                    
                    case 'monthly':
                        return recordDate.getMonth() === filterDate.getMonth() && 
                               recordDate.getFullYear() === filterDate.getFullYear();
                    
                    default:
                        return true;
                }
            });
            
            if (filteredData.length === 0) {
                alert('Tidak ada data untuk di-download berdasarkan filter yang dipilih!');
                return;
            }
            
            generatePDF(filteredData, periodFilter, filterDate, nameFilter);
        }
        
        function generatePDF(data, periodFilter, filterDate, nameFilter) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'mm', 'a4');
            
            // Set font
            doc.setFont('helvetica');
            
            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            const title = 'Rekap Absensi Karyawan PT. Transwisata Prima Aviation';
            const titleWidth = doc.getTextWidth(title);
            const pageWidth = doc.internal.pageSize.getWidth();
            doc.text(title, (pageWidth - titleWidth) / 2, 20);
            
            // Date range info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            let dateRangeText = '';
            
            switch (periodFilter) {
                case 'daily':
                    dateRangeText = `Tanggal: ${formatIndonesianDate(filterDate)}`;
                    break;
                case 'weekly':
                    const weekStart = new Date(filterDate);
                    weekStart.setDate(filterDate.getDate() - filterDate.getDay());
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    dateRangeText = `Periode: ${formatIndonesianDate(weekStart)} - ${formatIndonesianDate(weekEnd)}`;
                    break;
                case 'monthly':
                    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                                      'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                    dateRangeText = `Bulan: ${monthNames[filterDate.getMonth()]} ${filterDate.getFullYear()}`;
                    break;
            }
            
            if (nameFilter) {
                dateRangeText += ` | Filter Nama: "${nameFilter}"`;
            }
            
            const dateRangeWidth = doc.getTextWidth(dateRangeText);
            doc.text(dateRangeText, (pageWidth - dateRangeWidth) / 2, 30);
            
            // Generate timestamp
            const now = new Date();
            const generateTime = `Dibuat pada: ${formatIndonesianDateTime(now)}`;
            const generateTimeWidth = doc.getTextWidth(generateTime);
            doc.text(generateTime, (pageWidth - generateTimeWidth) / 2, 40);
            
            // Add employee names if name filter is applied
            let currentY = 50;
            if (nameFilter) {
                const uniqueEmployees = [...new Set(data.map(record => record.employeeName))];
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Karyawan:', 15, currentY);
                
                doc.setFont('helvetica', 'normal');
                const employeeText = uniqueEmployees.join(', ');
                doc.text(employeeText, 15, currentY + 7);
                currentY += 20;
            }
            
            // Prepare table data
            const tableData = [];
            
            // Sort data by date (newest first)
            const sortedData = data.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach(record => {
                const clockInTime = record.clockIn ? formatTime(record.clockIn.time) : '-';
                const clockOutTime = record.clockOut ? formatTime(record.clockOut.time) : '-';
                
                // Calculate total work time
                let totalTime = '-';
                if (record.clockIn && record.clockOut) {
                    const workTimeMs = new Date(record.clockOut.time).getTime() - new Date(record.clockIn.time).getTime();
                    const hours = Math.floor(workTimeMs / (1000 * 60 * 60));
                    const minutes = Math.floor((workTimeMs % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((workTimeMs % (1000 * 60)) / 1000);
                    totalTime = `${hours}j ${minutes}m ${seconds}d`;
                }
                
                // Determine status
                let status = '';
                if (!record.clockOut) {
                    status = 'Clock In';
                } else if (record.clockIn && record.clockIn.isLate) {
                    status = 'Terlambat';
                } else {
                    status = 'Hadir';
                }
                
                // Work report (remarks)
                const workReport = record.clockOut && record.clockOut.workReport ? 
                    record.clockOut.workReport.substring(0, 50) + (record.clockOut.workReport.length > 50 ? '...' : '') : '-';
                
                tableData.push([
                    formatIndonesianDate(new Date(record.date)),
                    record.employeeDivision || '-',
                    record.employeePosition || '-',
                    record.clockIn ? record.clockIn.dutyAs || '-' : '-',
                    record.clockIn ? record.clockIn.workType || '-' : '-',
                    status,
                    clockInTime,
                    clockOutTime,
                    totalTime,
                    workReport
                ]);
            });
            
            // Table headers
            const headers = [
                'DATE',
                'DIVISION',
                'POSITION', 
                'DUTY AS',
                'TYPE OF WORK',
                'STATUS ABSEN',
                'ABSEN MASUK',
                'ABSEN PULANG',
                'TOTAL TIME',
                'REMARKS PEKERJAAN'
            ];
            
            // Generate table
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: currentY,
                styles: {
                    fontSize: 8,
                    cellPadding: 2,
                    overflow: 'linebreak',
                    halign: 'center'
                },
                headStyles: {
                    fillColor: [79, 70, 229], // Purple color
                    textColor: 255,
                    fontStyle: 'bold',
                    halign: 'center'
                },
                columnStyles: {
                    0: { cellWidth: 25 }, // DATE
                    1: { cellWidth: 25 }, // DIVISION
                    2: { cellWidth: 30 }, // POSITION
                    3: { cellWidth: 25 }, // DUTY AS
                    4: { cellWidth: 25 }, // TYPE OF WORK
                    5: { cellWidth: 20 }, // STATUS ABSEN
                    6: { cellWidth: 20 }, // ABSEN MASUK
                    7: { cellWidth: 20 }, // ABSEN PULANG
                    8: { cellWidth: 20 }, // TOTAL TIME
                    9: { cellWidth: 40, halign: 'left' } // REMARKS PEKERJAAN
                },
                alternateRowStyles: {
                    fillColor: [245, 245, 245]
                },
                margin: { top: currentY, left: 10, right: 10 }
            });
            
            // Footer space (employee names now shown above table)
            
            // Add page numbers
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Halaman ${i} dari ${pageCount}`, pageWidth - 30, doc.internal.pageSize.getHeight() - 10);
            }
            
            // Generate filename
            const dateStr = filterDate.toISOString().split('T')[0];
            const periodStr = periodFilter === 'daily' ? 'Harian' : periodFilter === 'weekly' ? 'Mingguan' : 'Bulanan';
            const nameStr = nameFilter ? `_${nameFilter.replace(/\s+/g, '_')}` : '';
            const filename = `Rekap_Absensi_${periodStr}_${dateStr}${nameStr}.pdf`;
            
            // Save the PDF
            doc.save(filename);
        }
        
        function formatIndonesianDate(date) {
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                          'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            
            return `${day} ${month} ${year}`;
        }
        
        function formatIndonesianDateTime(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }
        
        function formatTime(dateTime) {
            const date = new Date(dateTime);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            return `${hours}:${minutes}:${seconds}`;
        }

        // Logout function
        function logout() {
            currentUser = null;
            isLoggedIn = false;
            clockedIn = false;
            clockInTime = null;
            clockOutTime = null;
            
            // Reset attendance data
            attendanceData = {
                clockIn: null,
                clockOut: null,
                locationIn: null,
                locationOut: null,
                photo: null,
                workPhoto: null
            };
            
            // Stop camera if running
            stopCamera();
            
            // Reset forms
            document.getElementById('loginForm').reset();
            document.getElementById('attendanceInForm').reset();
            document.getElementById('attendanceOutForm').reset();
            
            // Hide dashboards and show login
            document.getElementById('userDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Hide forms and summary
            document.getElementById('clockInForm').classList.add('hidden');
            document.getElementById('clockOutForm').classList.add('hidden');
            document.getElementById('attendanceSummary').classList.add('hidden');
            
            // Reset clock buttons
            document.getElementById('clockInBtn').disabled = false;
            document.getElementById('clockInBtn').classList.remove('opacity-50');
            document.getElementById('clockOutBtn').disabled = true;
            document.getElementById('clockOutBtn').classList.add('opacity-50');
            
            // Reset photo elements
            document.getElementById('cameraPreview').classList.add('hidden');
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('retakeBtn').classList.add('hidden');
            document.getElementById('workPhotoPreview').classList.add('hidden');
            
            // Reset profile elements
            document.getElementById('profileModal').classList.add('hidden');
            document.getElementById('profileMenu').classList.add('hidden');
            document.getElementById('userProfilePhoto').src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236B7280'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";
            document.getElementById('profilePhotoPreview').src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236B7280'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9772891640fc6be7',t:'MTc1NjUzODUzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
